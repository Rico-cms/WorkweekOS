<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WorkWeek OS ‚Äî Avatar System v6 (Infinite Engine)</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0b0b09; --s1:#141412; --s2:#1e1e1a; --s3:#272722;
  --b1:#2c2c26; --b2:#3a3a30;
  --gold:#d4a843; --gold2:#b08830; --golddim:rgba(212,168,67,0.13); --goldglow:rgba(212,168,67,0.3);
  --green:#79b554; --blue:#5191c9; --red:#c95a4a;
  --t1:#eee9dd; --t2:#9e9a8a; --t3:#5e5a4e; --t4:#3a3830;
  --r:8px; --r2:14px; --r3:22px;
  --fh:DM Sans; --fmono:Space Mono; --ftitle:Bebas Neue;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{height:100%}
body{font-family:var(--fh),sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:9000;opacity:.02;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)'/%3E%3C/svg%3E")}

/* ‚îÄ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ */
.scr{display:none} .scr.on{display:flex;flex-direction:column}
#ob.on{display:grid;grid-template-columns:272px 1fr}
#db.on{display:flex;flex-direction:column}

/* ‚ïê‚ïê‚ïê‚ïê SPLASH ‚ïê‚ïê‚ïê‚ïê */
#splash{min-height:100vh;align-items:center;justify-content:center;position:relative;overflow:hidden}
.sp-grid{position:absolute;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 59px,rgba(212,168,67,.03) 60px),
             repeating-linear-gradient(90deg,transparent,transparent 59px,rgba(212,168,67,.03) 60px)}
.sp-glow{position:absolute;width:700px;height:700px;border-radius:50%;
  background:radial-gradient(circle,rgba(212,168,67,.09) 0%,transparent 70%);
  top:50%;left:50%;transform:translate(-50%,-50%);animation:pulse 5s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.6}50%{transform:translate(-50%,-50%) scale(1.15);opacity:1}}
.sp-inner{position:relative;z-index:1;text-align:center;display:flex;flex-direction:column;align-items:center}
.sp-eyebrow{font-family:var(--fmono);font-size:9px;letter-spacing:.45em;color:var(--gold);text-transform:uppercase;
  opacity:0;animation:rise .7s .2s forwards}
.sp-logo{font-family:var(--ftitle);font-size:clamp(72px,12vw,148px);line-height:.88;letter-spacing:.03em;margin:18px 0 6px;
  opacity:0;animation:rise .8s .4s forwards}
.sp-logo em{color:var(--gold);font-style:normal}
.sp-sub{font-size:13px;color:var(--t2);font-weight:300;letter-spacing:.06em;max-width:340px;line-height:1.6;
  opacity:0;animation:rise .8s .55s forwards}
.sp-avatars{display:flex;gap:16px;margin:48px 0 52px;opacity:0;animation:rise .8s .7s forwards}
.sp-av-wrap{background:var(--s1);border:1px solid var(--b1);border-radius:var(--r2);
  padding:10px 14px 10px;text-align:center;transition:transform .2s,border-color .2s;cursor:default}
.sp-av-wrap:hover{transform:translateY(-4px);border-color:var(--gold)}
.sp-av-lbl{font-family:var(--fmono);font-size:8px;letter-spacing:.12em;color:var(--t3);margin-top:8px}
.sp-cta{padding:15px 54px;background:var(--gold);color:#0b0b09;font-family:var(--fmono);font-size:11px;
  font-weight:700;letter-spacing:.18em;text-transform:uppercase;border:none;cursor:pointer;
  clip-path:polygon(10px 0,100% 0,calc(100% - 10px) 100%,0 100%);
  transition:background .2s,transform .15s,box-shadow .2s;
  opacity:0;animation:rise .8s .85s forwards}
.sp-cta:hover{background:var(--gold2);transform:translateY(-2px);box-shadow:0 10px 28px var(--goldglow)}
@keyframes rise{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* ‚ïê‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê‚ïê */
#ob{display:none;min-height:100vh}
#ob.on{display:grid;grid-template-columns:272px 1fr}
.ob-side{background:var(--s1);border-right:1px solid var(--b1);padding:36px 26px;
  display:flex;flex-direction:column;position:sticky;top:0;height:100vh}
.ob-logo{font-family:var(--ftitle);font-size:21px;letter-spacing:.08em;margin-bottom:50px}
.ob-logo em{color:var(--gold);font-style:normal}
.ob-stps{display:flex;flex-direction:column;gap:2px}
.ob-stp{display:flex;align-items:center;gap:12px;padding:10px 13px;border-radius:var(--r);transition:background .2s;cursor:default}
.ob-stp.done{cursor:pointer}
.ob-stp.done:hover{background:rgba(255,255,255,.04)}
.ob-stp.cur{background:var(--golddim)}
.ob-stp-n{width:24px;height:24px;border-radius:50%;border:1.5px solid var(--b2);
  display:flex;align-items:center;justify-content:center;font-family:var(--fmono);font-size:10px;
  color:var(--t3);flex-shrink:0;transition:all .3s}
.ob-stp.cur .ob-stp-n{border-color:var(--gold);color:var(--gold);background:var(--golddim)}
.ob-stp.done .ob-stp-n{background:var(--green);border-color:var(--green);color:#0b0b09;font-size:12px}
.ob-stp-l{font-size:12px;color:var(--t3);transition:color .2s}
.ob-stp.cur .ob-stp-l{color:var(--t1)}
.ob-foot{margin-top:auto;padding-top:24px;border-top:1px solid var(--b1)}
.ob-prog-top{display:flex;justify-content:space-between;font-family:var(--fmono);font-size:9px;
  color:var(--t3);letter-spacing:.1em;margin-bottom:9px}
.ob-track{height:3px;background:var(--s3);border-radius:99px}
.ob-fill{height:3px;background:var(--gold);border-radius:99px;transition:width .5s cubic-bezier(.4,0,.2,1)}
.ob-main{padding:52px 60px;overflow-y:auto}
.ob-panel{display:none}
.ob-panel.on{display:block;animation:rise .35s forwards}
.ob-eye{font-family:var(--fmono);font-size:9px;letter-spacing:.35em;color:var(--gold);
  text-transform:uppercase;margin-bottom:13px}
.ob-ttl{font-family:var(--ftitle);font-size:50px;letter-spacing:.02em;line-height:.93;margin-bottom:8px}
.ob-sub{font-size:13px;color:var(--t2);font-weight:300;margin-bottom:38px;line-height:1.5}

/* Genre toggle */
.g-tog{display:inline-flex;background:var(--s2);border:1px solid var(--b1);
  border-radius:99px;padding:4px;gap:4px;margin-bottom:36px}
.g-btn{padding:8px 28px;border-radius:99px;font-family:var(--fmono);font-size:10px;
  letter-spacing:.12em;cursor:pointer;border:none;background:transparent;color:var(--t2);transition:all .2s}
.g-btn.on{background:var(--gold);color:#0b0b09;font-weight:700}

/* Morpho grid */
.m-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:36px}
.m-card{border:2px solid var(--b1);border-radius:var(--r2);background:var(--s1);
  cursor:pointer;transition:all .22s;overflow:hidden;position:relative;padding-bottom:14px}
.m-card:hover{border-color:var(--gold2);transform:translateY(-3px)}
.m-card.sel{border-color:var(--gold);background:rgba(212,168,67,.06)}
.m-card.sel::after{content:'‚úì';position:absolute;top:8px;right:8px;width:18px;height:18px;
  background:var(--gold);color:#0b0b09;border-radius:50%;font-size:9px;font-weight:700;
  display:flex;align-items:center;justify-content:center}
.m-av{height:148px;display:flex;align-items:flex-end;justify-content:center;padding:8px 6px 0}
.m-letter{font-family:var(--ftitle);font-size:26px;color:var(--gold);text-align:center;
  margin:6px 0 3px;letter-spacing:.05em}
.m-desc{font-size:9px;color:var(--t2);text-align:center;line-height:1.55;
  padding:0 8px;font-family:var(--fmono)}

/* Skin */
.sk-row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:32px}
.sk-sw{width:46px;height:46px;border-radius:50%;cursor:pointer;border:3px solid transparent;
  transition:all .2s}
.sk-sw:hover{transform:scale(1.12)}
.sk-sw.sel{border-color:var(--gold);box-shadow:0 0 0 3px var(--golddim)}
.sk-lbl{font-size:9px;color:var(--t3);font-family:var(--fmono);text-align:center;margin-top:5px;letter-spacing:.06em}

/* Slider */
.sl-blk{margin-bottom:28px}
.sl-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:11px}
.sl-n{font-size:10px;font-family:var(--fmono);letter-spacing:.15em;color:var(--t2);text-transform:uppercase}
.sl-v{font-family:var(--ftitle);font-size:21px;color:var(--gold);letter-spacing:.05em}
input[type=range]{-webkit-appearance:none;width:100%;height:4px;background:var(--s3);
  border-radius:99px;outline:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;
  border-radius:50%;background:var(--gold);border:3px solid var(--bg);cursor:pointer;
  box-shadow:0 0 10px var(--goldglow);transition:box-shadow .2s;margin-top:-8px}
input[type=range]::-webkit-slider-thumb:hover{box-shadow:0 0 20px var(--goldglow)}

/* Hier */
.hi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:30px}
.hi-item{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r);
  padding:14px 8px;cursor:pointer;text-align:center;transition:all .2s}
.hi-item:hover{border-color:var(--gold2)} .hi-item.sel{border-color:var(--gold);background:var(--golddim)}
.hi-ico{font-size:20px;margin-bottom:6px}
.hi-lbl{font-size:9px;font-family:var(--fmono);color:var(--t2);letter-spacing:.05em}

/* Job */
.job-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:36px}
.job-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  padding:18px 15px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:12px}
.job-card:hover{border-color:var(--gold2)} .job-card.sel{border-color:var(--gold);background:var(--golddim)}
.job-ico{font-size:22px;flex-shrink:0}
.job-n{font-size:13px;font-weight:500}
.job-c{font-size:10px;color:var(--t2);font-family:var(--fmono);margin-top:3px}

/* Budget */
.bud-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:28px}
.bud-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  padding:20px 12px 16px;cursor:pointer;transition:all .2s;text-align:center}
.bud-card:hover{border-color:var(--gold2)} .bud-card.sel{border-color:var(--gold);background:var(--golddim)}
.bud-amt{font-family:var(--ftitle);font-size:29px;color:var(--gold)}
.bud-unit{font-size:9px;color:var(--t2);font-family:var(--fmono);margin-top:2px}
.bud-tag{display:inline-block;margin-top:9px;padding:3px 8px;border-radius:4px;
  font-size:8px;font-family:var(--fmono);letter-spacing:.1em}
.tg{background:rgba(121,181,84,.15);color:var(--green)} .ta{background:var(--golddim);color:var(--gold)}

/* Climat */
.cl-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:36px}
.cl-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  padding:18px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:14px}
.cl-card:hover{border-color:var(--gold2)} .cl-card.sel{border-color:var(--gold);background:var(--golddim)}
.cl-ico{font-size:28px}
.cl-n{font-size:13px;font-weight:500}
.cl-c{font-size:10px;color:var(--t2);font-family:var(--fmono);margin-top:3px}

/* Recap */
.rc-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:26px}
.rc-item{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r);padding:15px 17px}
.rc-lbl{font-size:9px;font-family:var(--fmono);letter-spacing:.2em;color:var(--t2);
  text-transform:uppercase;margin-bottom:5px}
.rc-val{font-family:var(--ftitle);font-size:21px;color:var(--gold);letter-spacing:.05em}
.rules-box{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r2);
  padding:20px 22px;margin-bottom:34px}
.rl-title{font-family:var(--fmono);font-size:9px;letter-spacing:.25em;color:var(--t2);
  text-transform:uppercase;margin-bottom:14px}
.rl-row{display:flex;align-items:flex-start;gap:10px;padding:8px 0;
  border-bottom:1px solid rgba(255,255,255,.04);font-size:12px;color:var(--t2);line-height:1.5}
.rl-row:last-child{border-bottom:none}
.rl-i{flex-shrink:0;font-size:13px}

/* Nav btns */
.ob-nav{display:flex;gap:10px;padding-top:6px}
.btn-p{padding:13px 36px;background:var(--gold);color:#0b0b09;font-family:var(--fmono);
  font-size:10px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;
  border:none;border-radius:var(--r);cursor:pointer;transition:all .2s}
.btn-p:hover{background:var(--gold2);transform:translateY(-1px);box-shadow:0 6px 18px var(--goldglow)}
.btn-s{padding:13px 22px;background:transparent;border:1.5px solid var(--b2);color:var(--t2);
  font-family:var(--fmono);font-size:10px;letter-spacing:.1em;text-transform:uppercase;
  border-radius:var(--r);cursor:pointer;transition:all .2s}
.btn-s:hover{border-color:var(--t2);color:var(--t1)}
.btn-launch{padding:15px 50px;background:linear-gradient(135deg,var(--green),#5a8f3a);color:#0b0b09;
  font-family:var(--fmono);font-size:11px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;
  border:none;border-radius:var(--r);cursor:pointer;transition:all .2s}
.btn-launch:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(121,181,84,.3)}

/* ‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê */
#db{display:none;flex-direction:column;min-height:100vh}
#db.on{display:flex}
.db-bar{display:flex;align-items:center;justify-content:space-between;padding:15px 36px;
  border-bottom:1px solid var(--b1);background:rgba(11,11,9,.92);backdrop-filter:blur(16px);
  position:sticky;top:0;z-index:100}
.db-logo{font-family:var(--ftitle);font-size:21px;letter-spacing:.08em}
.db-logo em{color:var(--gold);font-style:normal}
.db-tabs{display:flex;gap:4px}
.db-tab{padding:7px 18px;border-radius:99px;font-family:var(--fmono);font-size:10px;
  letter-spacing:.08em;cursor:pointer;border:none;background:transparent;color:var(--t2);transition:all .2s}
.db-tab.on{background:var(--s2);color:var(--t1);border:1px solid var(--b1)}
.db-tab:hover:not(.on){color:var(--t1)}
.db-usr{display:flex;align-items:center;gap:10px;font-size:12px;color:var(--t2)}
.db-av{width:33px;height:33px;border-radius:50%;background:var(--gold);color:#0b0b09;
  display:flex;align-items:center;justify-content:center;font-family:var(--ftitle);font-size:15px}
.db-body{flex:1;display:grid;grid-template-columns:1fr 336px;min-height:0}
.db-main{padding:34px 40px;overflow-y:auto;position:relative}
.db-side{border-left:1px solid var(--b1);padding:26px 22px;overflow-y:auto}

/* Score card */
.sc-card{background:var(--s1);border:1px solid var(--b1);border-radius:var(--r2);
  padding:26px 30px;margin-bottom:26px;position:relative;overflow:hidden}
.sc-card::before{content:'';position:absolute;top:-50px;right:-50px;width:200px;height:200px;
  background:radial-gradient(circle,rgba(212,168,67,.1),transparent 70%);pointer-events:none}
.sc-lbl{font-size:9px;font-family:var(--fmono);letter-spacing:.22em;color:var(--t3);
  text-transform:uppercase;margin-bottom:6px}
.sc-top{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:20px}
.sc-n{font-family:var(--ftitle);font-size:86px;line-height:.9;color:var(--gold);letter-spacing:.02em}
.sc-grade{padding:5px 14px;border-radius:99px;font-family:var(--fmono);font-size:10px;font-weight:700;align-self:flex-start}
.sga{background:rgba(121,181,84,.15);color:var(--green)}
.sgb{background:var(--golddim);color:var(--gold)}
.sgc{background:rgba(81,145,201,.15);color:var(--blue)}
.sc-axes{display:grid;grid-template-columns:1fr 1fr;gap:10px 30px}
.ax{display:flex;flex-direction:column;gap:5px}
.ax-top{display:flex;justify-content:space-between;font-size:10px}
.ax-n{color:var(--t3);font-family:var(--fmono);letter-spacing:.04em}
.ax-v{color:var(--t2);font-family:var(--fmono)}
.ax-track{height:3px;background:var(--s3);border-radius:99px}
.ax-fill{height:3px;border-radius:99px;transition:width 1.2s cubic-bezier(.4,0,.2,1)}

/* Section title */
.sec-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.sec-ttl{font-family:var(--ftitle);font-size:28px;letter-spacing:.03em;display:flex;align-items:center;gap:10px}
.chips{display:flex;gap:7px;flex-wrap:wrap}
.chip{padding:5px 13px;border-radius:99px;font-size:10px;font-family:var(--fmono);
  letter-spacing:.05em;cursor:pointer;border:1px solid var(--b2);background:transparent;
  color:var(--t2);transition:all .2s}
.chip:hover,.chip.on{background:var(--golddim);border-color:var(--gold);color:var(--gold)}

/* Week grid */
.wk-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:20px}
.day-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  overflow:hidden;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1)}
.day-card:hover{border-color:var(--gold);transform:translateY(-4px);
  box-shadow:0 18px 44px rgba(0,0,0,.55)}
.dc-head{padding:11px 13px;display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid var(--b1)}
.dc-day{font-family:var(--ftitle);font-size:17px;letter-spacing:.06em}
.dc-score{font-family:var(--fmono);font-size:9px;font-weight:700;padding:3px 8px;border-radius:99px}
.dca{background:var(--golddim);color:var(--gold)}
.dcg{background:rgba(121,181,84,.18);color:var(--green)}

/* Avatar stage */
.av-stage{height:195px;background:linear-gradient(175deg,var(--s2) 0%,var(--s3) 100%);
  display:flex;align-items:flex-end;justify-content:center;position:relative;overflow:hidden}
.av-stage::after{content:'';position:absolute;bottom:0;left:0;right:0;height:45px;
  background:linear-gradient(to top,var(--s1) 0%,transparent 100%);z-index:2;pointer-events:none}
.av-stage svg{position:relative;z-index:1}
/* shadow under feet */
.av-stage::before{content:'';position:absolute;bottom:12px;left:50%;transform:translateX(-50%);
  width:50px;height:8px;background:rgba(0,0,0,.35);border-radius:50%;z-index:1;filter:blur(4px)}

.dc-body{padding:13px}
.dc-outfit-name{font-size:11px;font-weight:600;margin-bottom:8px;letter-spacing:.02em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dc-pieces{display:flex;flex-direction:column;gap:5px}
.dc-piece{display:flex;align-items:center;gap:7px;font-size:11px;color:var(--t2)}
.dc-dot{width:7px;height:7px;border-radius:2px;flex-shrink:0}
.dc-txt{flex:1;font-size:10.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dc-r{font-size:8px;font-family:var(--fmono);padding:1px 5px;border-radius:3px;
  background:var(--golddim);color:var(--gold);white-space:nowrap}
.dc-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:9px}
.dc-tag{font-size:8px;font-family:var(--fmono);padding:2px 7px;border-radius:4px;
  background:var(--s3);color:var(--t3);letter-spacing:.05em}

/* Sidebar */
.ss-sec{margin-bottom:26px}
.ss-t{font-family:var(--fmono);font-size:8px;letter-spacing:.3em;color:var(--t3);
  text-transform:uppercase;padding-bottom:9px;border-bottom:1px solid var(--b1);margin-bottom:13px}
.ss-row{display:flex;justify-content:space-between;align-items:center;
  padding:7px 0;border-bottom:1px solid rgba(255,255,255,.025);font-size:12px}
.ss-k{color:var(--t2)} .ss-v{font-family:var(--fmono);font-size:10px;color:var(--t1)}
.insight{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r);
  padding:11px 13px;margin-bottom:7px;font-size:11.5px;color:var(--t2);
  display:flex;gap:8px;align-items:flex-start;line-height:1.5}
.in-i{font-size:13px;flex-shrink:0;margin-top:1px}

/* Drawer */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:200;opacity:0;
  pointer-events:none;transition:opacity .3s;backdrop-filter:blur(8px)}
.overlay.on{opacity:1;pointer-events:all}
.drawer{position:fixed;right:0;top:0;bottom:0;width:440px;background:var(--s1);
  border-left:1px solid var(--b1);z-index:201;transform:translateX(100%);
  transition:transform .38s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column}
.drawer.on{transform:translateX(0)}
.dr-head{padding:20px 24px;border-bottom:1px solid var(--b1);display:flex;
  justify-content:space-between;align-items:center;flex-shrink:0}
.dr-close{width:29px;height:29px;border-radius:50%;background:var(--s2);border:1px solid var(--b1);
  cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;
  color:var(--t2);transition:all .2s}
.dr-close:hover{color:var(--t1);border-color:var(--t2)}
.dr-body{flex:1;overflow-y:auto;padding:22px 24px;display:flex;flex-direction:column;gap:20px}
.dr-av-stage{background:linear-gradient(170deg,var(--s2),var(--s3));border-radius:var(--r2);
  border:1px solid var(--b1);height:280px;display:flex;align-items:flex-end;
  justify-content:center;overflow:hidden;position:relative}
.dr-av-stage::after{content:'';position:absolute;inset:0;
  background:linear-gradient(to top,var(--s2) 0%,transparent 45%);pointer-events:none}
.dr-av-stage::before{content:'';position:absolute;bottom:14px;left:50%;transform:translateX(-50%);
  width:60px;height:10px;background:rgba(0,0,0,.3);border-radius:50%;z-index:1;filter:blur(5px)}
.dr-av-stage svg{position:relative;z-index:2}
.dr-metrics{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.dr-metric{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r);
  padding:14px;text-align:center}
.dr-mv{font-family:var(--ftitle);font-size:32px}
.dr-ml{font-size:9px;font-family:var(--fmono);color:var(--t3);letter-spacing:.12em;margin-top:2px}

/* Wardrobe */
.wrd-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:13px;margin-top:18px}
.wrd-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  overflow:hidden;cursor:pointer;transition:all .2s}
.wrd-card:hover{border-color:var(--gold2);transform:translateY(-2px)}
.wrd-img{height:100px;background:var(--s2);display:flex;align-items:center;
  justify-content:center;border-bottom:1px solid var(--b1);font-size:44px}
.wrd-info{padding:11px 13px}
.wrd-n{font-size:12px;font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.wrd-t{font-size:9px;color:var(--t3);font-family:var(--fmono)}
.wrd-st{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.wrd-cpp{font-size:10px;font-family:var(--fmono);color:var(--green)}
.wrd-uses{font-size:9px;color:var(--t3)}

/* Toast */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(10px);
  background:var(--s1);border:1px solid var(--gold);color:var(--gold);padding:10px 22px;
  border-radius:99px;font-family:var(--fmono);font-size:10px;letter-spacing:.08em;
  z-index:9001;opacity:0;pointer-events:none;transition:all .3s}
.toast.on{opacity:1;transform:translateX(-50%) translateY(0)}

.btn-loadmore{width:100%;padding:18px;background:var(--s2);border:1px dashed var(--b2);
  border-radius:var(--r2);color:var(--t2);font-family:var(--fmono);font-size:11px;
  letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s;
  margin-top:15px;display:flex;align-items:center;justify-content:center;gap:10px}
.btn-loadmore:hover{border-color:var(--gold);color:var(--gold);background:var(--golddim)}

@media(max-width:1100px){
  #ob.on{grid-template-columns:1fr} .ob-side{display:none} .ob-main{padding:36px 26px}
  .m-grid{grid-template-columns:repeat(3,1fr)} .wk-grid{grid-template-columns:1fr 1fr}
  .db-body{grid-template-columns:1fr} .db-side{display:none}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPLASH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="splash" class="scr on">
  <div class="sp-grid"></div>
  <div class="sp-glow"></div>
  <div class="sp-inner">
    <p class="sp-eyebrow">G√©n√©rateur Proc√©dural Infini</p>
    <h1 class="sp-logo">WORK<em>WEEK</em><br>OS</h1>
    <p class="sp-sub">Le Styliste IA sans limite. Des milliards de tenues calcul√©es en temps r√©el selon ton profil exact.</p>
    <div class="sp-avatars" id="spAv"></div>
    <button class="sp-cta" onclick="go('ob')">Initialiser le syst√®me ‚Üí</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="ob" class="scr">
  <div class="ob-side">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:50px">
      <button onclick="backToSplash()" title="Retour √† l'accueil"
        style="width:28px;height:28px;border-radius:50%;background:transparent;border:1.5px solid var(--b2);
               color:var(--t3);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;
               transition:all .2s;flex-shrink:0;line-height:1"
        onmouseover="this.style.borderColor='var(--t2)';this.style.color='var(--t1)'"
        onmouseout="this.style.borderColor='var(--b2)';this.style.color='var(--t3)'">‚Üê</button>
      <div class="ob-logo" style="margin-bottom:0">Work<em>Week</em> OS</div>
    </div>
    <div class="ob-stps" id="obStps"></div>
    <div class="ob-foot">
      <div class="ob-prog-top"><span>PROGRESSION</span><span id="obPct">0%</span></div>
      <div class="ob-track"><div class="ob-fill" id="obFill" style="width:0%"></div></div>
    </div>
  </div>
  <div class="ob-main">

    <!-- P1: Genre + Morphologie -->
    <div class="ob-panel on" id="p1">
      <div class="ob-eye">√âtape 01 ‚Äî Profil Morphologique</div>
      <h2 class="ob-ttl">Genre &<br>Morphologie</h2>
      <p class="ob-sub">Ces choix alt√®rent physiquement les coupes g√©n√©r√©es par l'algorithme.</p>
      <div class="g-tog" id="gTog">
        <button class="g-btn on" onclick="setG('M',this)">MASCULIN</button>
        <button class="g-btn" onclick="setG('F',this)">F√âMININ</button>
      </div>
      <div class="m-grid" id="mGrid"></div>
      <div class="ob-nav"><button class="btn-p" onclick="nxt()">Continuer ‚Üí</button></div>
    </div>

    <!-- P2: Teint + Taille + Niveau -->
    <div class="ob-panel" id="p2">
      <div class="ob-eye">√âtape 02 ‚Äî Apparence & Stature</div>
      <h2 class="ob-ttl">Teint &<br>Taille</h2>
      <p class="ob-sub">Personnalise les recommandations chromatiques et de coupe</p>
      <div style="margin-bottom:30px">
        <div class="sl-n" style="margin-bottom:13px">Teint de peau</div>
        <div class="sk-row" id="skRow"></div>
      </div>
      <div class="sl-blk">
        <div class="sl-hd"><span class="sl-n">Taille</span><span class="sl-v" id="tlDisp">175 cm</span></div>
        <input type="range" min="150" max="200" value="175" oninput="S.taille=+this.value;document.getElementById('tlDisp').textContent=this.value+' cm'">
      </div>
      <div class="sl-n" style="margin-bottom:11px">Niveau hi√©rarchique</div>
      <div class="hi-grid" id="hiGrid"></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">‚Üê Retour</button>
        <button class="btn-p" onclick="nxt()">Continuer ‚Üí</button>
      </div>
    </div>

    <!-- P3: Profession -->
    <div class="ob-panel" id="p3">
      <div class="ob-eye">√âtape 03 ‚Äî Contexte Professionnel</div>
      <h2 class="ob-ttl">Secteur<br>d'activit√©</h2>
      <p class="ob-sub">D√©finit le "Dress Code" structurel de ta semaine (Strict, Smart, ou Casual).</p>
      <div class="job-grid" id="jGrid"></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">‚Üê Retour</button>
        <button class="btn-p" onclick="nxt()">Continuer ‚Üí</button>
      </div>
    </div>

    <!-- P4: Budget + Climat -->
    <div class="ob-panel" id="p4">
      <div class="ob-eye">√âtape 04 ‚Äî Contraintes</div>
      <h2 class="ob-ttl">Budget &<br>Climat</h2>
      <p class="ob-sub">Le climat coupe les manches. Le budget modifie les mati√®res (Couleurs sombres = Laine froide/Soie).</p>
      <div style="margin-bottom:28px">
        <div class="sl-n" style="margin-bottom:12px">Budget mensuel tenues</div>
        <div class="bud-grid" id="bGrid"></div>
      </div>
      <div class="sl-n" style="margin-bottom:12px">Climat dominant</div>
      <div class="cl-grid" id="cGrid"></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">‚Üê Retour</button>
        <button class="btn-p" onclick="nxt()">Continuer ‚Üí</button>
      </div>
    </div>

    <!-- P5: Recap -->
    <div class="ob-panel" id="p5">
      <div class="ob-eye">√âtape 05 ‚Äî Initialisation</div>
      <h2 class="ob-ttl">G√©n√©ration<br>Proc√©durale</h2>
      <p class="ob-sub">Aucune base de donn√©es n'est utilis√©e. Le syst√®me va "dessiner" des tenues in√©dites bas√©es sur tes choix.</p>
      <div class="rc-grid" id="rcGrid"></div>
      <div class="rules-box"><div class="rl-title">Directives appliqu√©es par l'IA</div><div id="rlList"></div></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">‚Üê Retour</button>
        <button class="btn-launch" onclick="launch()">‚ö° Lancer la G√©n√©ration</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="db" class="scr">
  <div class="db-bar">
    <div style="display:flex;align-items:center;gap:12px">
      <button onclick="backToOnboarding()" title="Modifier le profil"
        style="display:flex;align-items:center;gap:7px;padding:7px 14px;border-radius:99px;
               background:transparent;border:1.5px solid var(--b2);color:var(--t2);
               font-family:var(--fmono);font-size:9px;letter-spacing:.1em;cursor:pointer;
               transition:all .2s"
        onmouseover="this.style.borderColor='var(--gold)';this.style.color='var(--gold)'"
        onmouseout="this.style.borderColor='var(--b2)';this.style.color='var(--t2)'">
        <span>‚Üê</span> PROFIL
      </button>
      <div class="db-logo">Work<em>Week</em> OS</div>
    </div>
    <div class="db-tabs">
      <button class="db-tab on" onclick="dTab('week',this)">Semaine</button>
      <button class="db-tab" onclick="dTab('wardrobe',this)">Garde-robe dynamique</button>
      <button class="db-tab" onclick="dTab('career',this)">Carri√®re</button>
    </div>
    <div class="db-usr"><span id="dbUL"></span><div class="db-av" id="dbAv"></div></div>
  </div>
  <div class="db-body">
    <div class="db-main">
      <div id="t-week">
        <div class="sc-card">
          <div class="sc-lbl">Indice d'Adaptation (Score)</div>
          <div class="sc-top">
            <div class="sc-n" id="scN">‚Äî</div>
            <div class="sc-grade" id="scG"></div>
          </div>
          <div class="sc-axes" id="scAx"></div>
        </div>
        <div class="sec-hd">
          <div class="sec-ttl">Semaines G√©n√©r√©es <span id="wkCount" style="font-family:var(--fmono);font-size:12px;color:var(--t3);margin-top:5px;font-weight:normal"></span></div>
          <div class="chips"><div class="chip on" id="dChip">5 jours</div><div class="chip" id="rChip">‚Äî r√©utilis√©es</div></div>
        </div>
        <div class="wk-grid" id="wGrid"></div>
        <button class="btn-loadmore" onclick="generateMoreDays()">
          <span>+</span> G√©n√©rer la semaine suivante (Variation in√©dite)
        </button>
      </div>
      <div id="t-wardrobe" style="display:none">
        <div class="sec-hd">
          <div class="sec-ttl">Garde-robe extraite</div>
          <div class="chips" id="wrdChips">
            <div class="chip on" onclick="wrdF('all',this)">Tout</div>
            <div class="chip" onclick="wrdF('haut',this)">Hauts</div>
            <div class="chip" onclick="wrdF('bas',this)">Bas / Jupes</div>
            <div class="chip" onclick="wrdF('robe',this)">Robes</div>
            <div class="chip" onclick="wrdF('chaussures',this)">Chaussures</div>
          </div>
        </div>
        <div class="wrd-grid" id="wrdGrid"></div>
      </div>
      <div id="t-career" style="display:none">
        <div class="sec-ttl" style="margin-bottom:22px">√âvolution de Style recommand√©e</div>
        <div id="careerCont"></div>
      </div>
    </div>
    <div class="db-side">
      <div class="ss-sec"><div class="ss-t">Profil actif</div><div id="ssProf"></div></div>
      <div class="ss-sec"><div class="ss-t">Insights moteur</div><div id="ssIns"></div></div>
      <div class="ss-sec"><div class="ss-t">Statistiques globales</div><div id="ssSt"></div></div>
    </div>
  </div>
</div>

<div class="overlay" id="ov" onclick="closeD()"></div>
<div class="drawer" id="drw">
  <div class="dr-head">
    <div>
      <div style="font-family:var(--fmono);font-size:9px;color:var(--t3);letter-spacing:.25em;text-transform:uppercase;margin-bottom:3px" id="drDay"></div>
      <div style="font-family:var(--ftitle);font-size:24px;letter-spacing:.05em" id="drTitle"></div>
    </div>
    <div class="dr-close" onclick="closeD()">√ó</div>
  </div>
  <div class="dr-body" id="drBody"></div>
</div>
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  √âTAT GLOBAL & VARIABLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S = { genre:'M', morpho:'H', teint:'s4', taille:175, hier:1, prof:'finance', budget:35000, climat:'tropical' };
let curStep = 1;
const STEPS = 5;
let GENERATED_WEEK = [];
let WARDROBE_EXTRACT = [];
let weekOffset = 0; // Permet de g√©n√©rer √† l'infini

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HELPERS (Couleurs, Ombres)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const shade=(hex,n)=>{if(!hex||hex[0]!='#')return hex||'#888';const r=parseInt(hex.slice(1),16);const R=Math.min(255,Math.max(0,(r>>16)+n)),G=Math.min(255,Math.max(0,((r>>8)&255)+n)),B=Math.min(255,Math.max(0,(r&255)+n));return '#'+((R<<16)|(G<<8)|B).toString(16).padStart(6,'0')};

const SKINS = [
  {id:'s1', hex:'#FDDBB4', stroke:'#e8b88a', label:'Clair'},
  {id:'s2', hex:'#E8A87C', stroke:'#d09060', label:'Beige'},
  {id:'s3', hex:'#C97A45', stroke:'#a85e30', label:'Moyen'},
  {id:'s4', hex:'#A05C2A', stroke:'#844a20', label:'Olive'},
  {id:'s5', hex:'#7A3F1A', stroke:'#60300e', label:'Brun'},
  {id:'s6', hex:'#3E1E0A', stroke:'#2a1406', label:'Fonc√©'},
];
const skinHex = id => (SKINS.find(s=>s.id===id)||SKINS[3]).hex;
const skinStroke = id => (SKINS.find(s=>s.id===id)||SKINS[3]).stroke;
const HAIR_C = { s1:'#4a2e12', s2:'#2e1808', s3:'#1a0c04', s4:'#120802', s5:'#0a0402', s6:'#080402' };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BASES DE DONN√âES (M√©tiers, Niveaux, Budgets, Climats)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const JOBS=[
  {id:'finance',ico:'üè¶',n:'Finance / Banque',   c:'STRICT ‚Äî code formel impos√©', code:'strict'},
  {id:'droit',  ico:'‚öñÔ∏è',n:'Droit / Juridique',  c:'STRICT ‚Äî formelle uniquement', code:'strict'},
  {id:'gouv',   ico:'üèõÔ∏è',n:'Gouvernement',       c:'STRICT ‚Äî sobre & officiel', code:'strict'},
  {id:'conseil',ico:'üìä',n:'Consulting',          c:'SMART ‚Äî formel et smart', code:'smart'},
  {id:'sante',  ico:'üè•',n:'Sant√©',               c:'SMART ‚Äî fonctionnel propre', code:'smart'},
  {id:'educ',   ico:'üéì',n:'Enseignement',        c:'SMART ‚Äî respectable', code:'smart'},
  {id:'tech',   ico:'üíª',n:'Tech / Startup',     c:'CASUAL ‚Äî cr√©atif et casual', code:'casual'},
  {id:'comm',   ico:'üì¢',n:'Communication',       c:'CASUAL ‚Äî expressif accept√©', code:'casual'},
  {id:'commerce',ico:'üõí',n:'Commerce',           c:'CASUAL ‚Äî d√©contract√© mobile', code:'casual'},
];
const HIER=[{i:'üå±',l:'Junior'},{i:'üìà',l:'Manager'},{i:'üíé',l:'Directeur'},{i:'üëë',l:'C-Level'}];
const BUDGETS=[{v:15000,a:'15K',t:'ESSENTIEL',tc:'tg'},{v:35000,a:'35K',t:'SMART',tc:'tg'},{v:75000,a:'75K',t:'PREMIUM',tc:'ta'},{v:150000,a:'150K+',t:'LUXE',tc:'ta'}];
const CLIMATS=[
  {id:'tropical', ico:'‚òÄÔ∏è',n:'Tropical Chaud',  c:'Abidjan ¬∑ Dakar ¬∑ Lom√©'},
  {id:'semiaride',ico:'üåµ',n:'Semi-Aride',       c:'Bamako ¬∑ Niamey ¬∑ Ouagadougou'},
  {id:'equatorial',ico:'üåßÔ∏è',n:'√âquatorial',     c:'Douala ¬∑ Kinshasa ¬∑ Libreville'},
  {id:'altitude', ico:'‚õ∞Ô∏è',n:'Altitude',         c:'Nairobi ¬∑ Kigali ¬∑ Addis-Abeba'},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MOTEUR PROC√âDURAL (Palettes drastiquement √©tendues)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PALETTES = {
  formal_dark: ['#1e293b', '#0f172a', '#171717', '#27272a', '#1c1917', '#111827', '#3f3f46', '#2d3748', '#1a202c', '#2c3e50', '#34495e'],
  formal_light: ['#cbd5e1', '#e2e8f0', '#e5e7eb', '#d6d3d1', '#f3f4f6', '#f8fafc', '#ecf0f1', '#bdc3c7', '#95a5a6'],
  smart: ['#7f1d1d', '#14532d', '#451a03', '#3f6212', '#831843', '#1e3a8a', '#2c3e50', '#8e44ad', '#2980b9', '#27ae60', '#16a085', '#d35400', '#c0392b', '#34495e'],
  casual: ['#ea580c', '#0284c7', '#d97706', '#65a30d', '#0d9488', '#9333ea', '#f39c12', '#e67e22', '#e74c3c', '#3498db', '#9b59b6', '#1abc9c', '#f1c40f'],
  shirts: ['#ffffff', '#f8fafc', '#fdf8f6', '#f0f9ff', '#fefce8', '#e0f7fa', '#fce4ec', '#f3e5f5', '#fff8e1', '#e8f5e9'],
  pants_c: ['#1e1b4b', '#171717', '#3f3f46', '#e7e5e4', '#d6d3d1', '#78716c', '#2c3e50', '#7f8c8d', '#95a5a6'],
  shoes_f: ['#1a1a18', '#3b2818', '#451a03', '#171717', '#2c1e16', '#4a2311'],
  shoes_c: ['#ffffff', '#f8fafc', '#f3f4f6', '#1a1a18', '#e5e7eb', '#d1d5db']
};

function generateUniqueOutfit(S, type, temp, dayIndex) {
  const isHot = temp === 'hot';
  let o = { id: `gen_${dayIndex}_${Date.now()}_${Math.random()}`, g: S.genre, type: type, short: isHot };
  let rnd = (arr) => arr[Math.floor(Math.random()*arr.length)]; 
  
  // 1. D√âFINITION DES PI√àCES (Structure) : Ajout massif de "Blazer" (D√©pareill√©)
  if (S.genre === 'M') {
      if (type === 'formal') { o.tType = Math.random()>0.3 ? 'suit' : 'blazer'; o.bType = 'pants'; o.sType = 'derby'; o.short = false; }
      else if (type === 'smart') { o.tType = isHot && Math.random()>0.5 ? 'polo' : (Math.random()>0.4 ? 'shirt' : 'blazer'); o.bType = 'pants'; o.sType = 'derby'; o.short = isHot && o.tType !== 'blazer'; }
      else { o.tType = isHot ? 'polo' : 'shirt'; o.bType = 'pants'; o.sType = 'sneakers'; o.short = isHot; }
  } else {
      if (type === 'formal') {
          o.tType = Math.random()>0.3 ? 'suit' : (Math.random()>0.5 ? 'dress' : 'blazer');
          o.bType = o.tType==='suit' ? (Math.random()>0.5?'skirt':'pants') : (o.tType==='dress'?'dress':'pants');
          o.sType = 'heels'; o.short = isHot && o.tType==='dress';
      } else if (type === 'smart') {
          o.tType = Math.random()>0.4 ? 'blouse' : (Math.random()>0.5 ? 'dress' : 'blazer');
          o.bType = o.tType==='dress' ? 'dress' : (Math.random()>0.5?'skirt':'pants');
          o.sType = Math.random()>0.5 ? 'heels' : 'flats'; o.short = isHot && o.tType !== 'blazer';
      } else {
          o.tType = Math.random()>0.5 ? 'blouse' : 'polo';
          o.bType = Math.random()>0.5 ? 'pants' : 'skirt';
          o.sType = 'sneakers'; o.short = isHot;
      }
  }

  // 2. PALETTES DE COULEURS SELON TYPE
  let mainColors = type === 'formal' ? (isHot ? [...PALETTES.formal_dark, ...PALETTES.formal_light] : PALETTES.formal_dark) : 
                   type === 'smart' ? [...PALETTES.formal_dark, ...PALETTES.smart] : 
                   [...PALETTES.smart, ...PALETTES.casual, ...PALETTES.formal_dark];
  let bottomColors = type === 'casual' ? PALETTES.pants_c : mainColors;

  // 3. COLORATION (G√©n√©ration proc√©durale pure)
  if (o.tType === 'suit') {
      o.jacket = rnd(mainColors); o.pants = o.jacket; o.shirt = rnd(PALETTES.shirts);
      if (S.genre === 'M') o.tie = rnd(PALETTES.smart);
  } else if (o.tType === 'blazer') {
      // D√©pareill√© ! Multiplie les combinaisons par 100
      o.jacket = rnd(mainColors);
      o.pants = rnd(bottomColors.filter(c => c !== o.jacket && c !== shade(o.jacket, -10))); 
      if (!o.pants) o.pants = '#171717';
      o.shirt = rnd(PALETTES.shirts);
  } else if (o.tType === 'dress') {
      o.shirt = rnd(mainColors); o.pants = o.shirt; 
  } else {
      o.shirt = rnd(type === 'casual' ? [...mainColors, ...PALETTES.shirts] : (type === 'smart' && S.genre === 'M' ? PALETTES.shirts : mainColors));
      o.pants = rnd(bottomColors);
      if (o.shirt === o.pants) o.pants = '#171717'; 
  }
  
  o.shoes = o.sType === 'sneakers' ? rnd(PALETTES.shoes_c) : rnd(PALETTES.shoes_f);

  // 4. R√âGLES D'ADAPTATION (Styliste IA)
  if (S.morpho === 'O' && o.tType !== 'blazer') { o.shirt = shade(o.pants, -30); if (o.tType === 'suit') o.jacket = o.pants; } 
  else if (S.morpho === 'A' && o.tType !== 'dress' && o.tType !== 'suit') { o.shirt = rnd(PALETTES.shirts); o.pants = rnd(PALETTES.formal_dark); } 
  else if (S.morpho === 'V' && o.tType !== 'dress' && o.tType !== 'suit') { o.shirt = rnd(PALETTES.formal_dark); o.pants = rnd(PALETTES.formal_light); }
  
  if (S.hier >= 2 && (o.tType === 'suit' || o.tType === 'dress')) {
      o.jacket = shade(o.jacket, -20); o.pants = shade(o.pants, -20); o.shirt = shade(o.shirt, -5);
  }

  // 5. G√âN√âRATION S√âMANTIQUE (Noms)
  let n = "";
  if (o.tType === 'suit') n = (S.genre==='M'?'Costume ':'Tailleur ') + (o.bType==='skirt'?'Jupe ':'') + (S.hier>=2?'Couture':'Structur√©');
  else if (o.tType === 'blazer') n = (S.genre==='M'?'Blazer D√©pareill√©':'Veste D√©pareill√©e');
  else if (o.tType === 'dress') n = 'Robe ' + (type==='formal'?'Couture':(type==='smart'?'Midi':'Fluide'));
  else if (o.tType === 'blouse') n = 'Chemisier & ' + (o.bType==='skirt'?'Jupe':'Pantalon');
  else if (o.tType === 'shirt') n = 'Chemise & ' + (type==='casual'?'Jean/Chino':'Pantalon Tailleur');
  else if (o.tType === 'polo') n = 'Polo & ' + (o.bType==='skirt'?'Jupe':'Chino');
  
  if (S.budget >= 150000) n = 'Premium ' + n;
  if (isHot) n += ' (L√©ger)';

  o.n = n;
  return o;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AVATAR ENGINE (SVG Fashion Sketch)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MORPH = { V:{sw:1.20,hw:0.85,tw:0.95}, A:{sw:0.85,hw:1.25,tw:1.00}, H:{sw:1.00,hw:1.00,tw:1.05}, X:{sw:1.05,hw:1.05,tw:0.75}, O:{sw:1.00,hw:1.00,tw:1.25} };

function buildAvatar(morpho, skinId, outfitObj, genre='M', pxH=180) {
  const m = MORPH[morpho] || MORPH.H;
  const VW = 120, VH = 200;
  const cx = VW / 2;
  const u = 22; 

  const y = { top:0.5*u, eye:1.1*u, chin:1.6*u, neckBase:1.9*u, shoulder:2.1*u, chest:3.0*u, waist:3.8*u, hip:4.8*u, crotch:5.1*u, knee:6.8*u, ankle:8.4*u, floor:8.8*u };
  let bSw = genre === 'M' ? 1.7 * u : 1.35 * u;
  let bTw = genre === 'M' ? 1.3 * u : 1.0 * u;
  let bHw = genre === 'M' ? 1.35 * u : 1.5 * u;

  const w = { head:0.75*u, neck:genre==='M'?0.45*u:0.35*u, shoulder:bSw*m.sw, chest:((bSw*m.sw)+(bTw*m.tw))*0.5, waist:bTw*m.tw, hip:bHw*m.hw, arm:genre==='M'?0.35*u:0.28*u, legUp:genre==='M'?0.55*u:0.5*u, legDown:0.3*u };
  if (genre === 'F') { w.chest *= 1.05; w.waist *= 0.85; }

  const skin = skinHex(skinId); const sk = shade(skin, -20); const hair = HAIR_C[skinId] || '#1a0c04'; const o = outfitObj;

  let layers = [];
  layers.push(buildExactLegsShoes(o, cx, y, w, skin));
  layers.push(buildExactTorso(o, cx, y, w, skin, genre));
  layers.push(buildExactArms(o, cx, y, w, skin, genre));
  layers.push(buildFashionHead(skin, sk, hair, cx, y, w, genre)); 

  return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${VW} ${VH}" width="${Math.round(pxH * (VW/VH))}" height="${pxH}">${layers.join('')}</svg>`;
}

function buildExactTorso(o, cx, y, w, skin, genre) {
  const pc = o.shirt; const sc = shade(pc, -15);
  const jc = o.jacket; const jsc = shade(jc, -20);
  const hasJacket = o.tType === 'suit' || o.tType === 'blazer';
  const isDress = o.tType === 'dress';

  let out = `<rect x="${cx - w.neck/2}" y="${y.chin}" width="${w.neck}" height="${y.neckBase - y.chin + 2}" fill="${skin}"/>`;

  const ox = hasJacket ? 4 : (isDress ? 1 : 2); 
  const sW = w.shoulder/2 + ox; const cW = w.chest/2 + ox; const tW = w.waist/2 + (hasJacket ? ox+2 : ox); const hW = w.hip/2 + ox;

  const bodyPath = `M ${cx},${y.neckBase} L ${cx - w.neck/2 - 1},${y.neckBase} C ${cx - sW*0.6},${y.neckBase} ${cx - sW},${y.shoulder-2} ${cx - sW},${y.shoulder} C ${cx - cW},${y.chest} ${cx - tW},${y.waist-5} ${cx - tW},${y.waist} C ${cx - tW},${y.waist+5} ${cx - hW},${y.hip-5} ${cx - hW},${y.hip} L ${cx + hW},${y.hip} C ${cx + hW},${y.hip-5} ${cx + tW},${y.waist+5} ${cx + tW},${y.waist} C ${cx + tW},${y.waist-5} ${cx + cW},${y.chest} ${cx + sW},${y.shoulder} C ${cx + sW},${y.shoulder-2} ${cx + sW*0.6},${y.neckBase} ${cx + w.neck/2 + 1},${y.neckBase} Z`;
  out += `<path d="${bodyPath}" fill="${pc}" stroke="${sc}" stroke-width="0.5"/>`;

  if (hasJacket || o.tType === 'shirt') {
     out += `<path d="M ${cx - w.neck/2},${y.neckBase} L ${cx - w.neck/2 - 5},${y.neckBase + 6} L ${cx},${y.neckBase + 10} L ${cx + w.neck/2 + 5},${y.neckBase + 6} L ${cx + w.neck/2},${y.neckBase} Z" fill="${shade(pc,-5)}"/>`;
     if(o.tie) out += `<path d="M ${cx-2},${y.neckBase+8} L ${cx-3.5},${y.waist} L ${cx},${y.waist+5} L ${cx+3.5},${y.waist} L ${cx+2},${y.neckBase+8} Z" fill="${o.tie}"/>`;
  }

  if (hasJacket) {
     const jBody = `M ${cx - sW},${y.shoulder} C ${cx - cW - 2},${y.chest} ${cx - tW - 2},${y.waist} ${cx - tW - 2},${y.waist} C ${cx - tW - 2},${y.waist+10} ${cx - hW - 2},${y.crotch} ${cx - hW - 2},${y.crotch+5} L ${cx - 5},${y.crotch+5} L ${cx - 6},${y.waist+15} L ${cx - w.neck/2 - 2},${y.neckBase+4} L ${cx - sW*0.5},${y.neckBase-2} Z`;
     const jBodyR = `M ${cx + sW},${y.shoulder} C ${cx + cW + 2},${y.chest} ${cx + tW + 2},${y.waist} ${cx + tW + 2},${y.waist} C ${cx + tW + 2},${y.waist+10} ${cx + hW + 2},${y.crotch} ${cx + hW + 2},${y.crotch+5} L ${cx + 5},${y.crotch+5} L ${cx + 6},${y.waist+15} L ${cx + w.neck/2 + 2},${y.neckBase+4} L ${cx + sW*0.5},${y.neckBase-2} Z`;
     out += `<path d="${jBody}" fill="${jc}" stroke="${jsc}" stroke-width="0.5"/>`;
     out += `<path d="${jBodyR}" fill="${jc}" stroke="${jsc}" stroke-width="0.5"/>`;
     out += `<path d="M ${cx - w.neck/2 - 2},${y.neckBase+4} L ${cx - 12},${y.chest} L ${cx - 6},${y.waist+15} L ${cx - 5},${y.chest+5} Z" fill="${shade(jc, -15)}"/>`;
     out += `<path d="M ${cx + w.neck/2 + 2},${y.neckBase+4} L ${cx + 12},${y.chest} L ${cx + 6},${y.waist+15} L ${cx + 5},${y.chest+5} Z" fill="${shade(jc, -15)}"/>`;
  }

  if (genre === 'F' && !hasJacket) {
     out += `<path d="M ${cx - cW + 4},${y.chest+4} Q ${cx - cW/2},${y.chest+12} ${cx},${y.chest+6}" stroke="${sc}" stroke-width="0.6" fill="none" opacity="0.4"/>`;
     out += `<path d="M ${cx + cW - 4},${y.chest+4} Q ${cx + cW/2},${y.chest+12} ${cx},${y.chest+6}" stroke="${sc}" stroke-width="0.6" fill="none" opacity="0.4"/>`;
  }
  return out;
}

function buildExactArms(o, cx, y, w, skin, genre) {
  const hasJacket = o.tType === 'suit' || o.tType === 'blazer';
  const armC = hasJacket ? o.jacket : o.shirt;
  const armSk = shade(armC,-18);
  const sW = w.shoulder/2 + (hasJacket ? 4 : 2);
  const elbowY = y.waist; const wristY = y.crotch + 5; const armW = w.arm;

  let out = "";
  if (o.short) {
      const sleeveY = y.chest + 10;
      out += `<path d="M ${cx - sW + 2},${y.shoulder} Q ${cx - sW - armW/2},${y.chest} ${cx - sW - armW/2},${sleeveY} L ${cx - sW + armW},${sleeveY} Z" fill="${armC}" stroke="${armSk}" stroke-width="0.6"/>`;
      out += `<path d="M ${cx + sW - 2},${y.shoulder} Q ${cx + sW + armW/2},${y.chest} ${cx + sW + armW/2},${sleeveY} L ${cx + sW - armW},${sleeveY} Z" fill="${armC}" stroke="${armSk}" stroke-width="0.6"/>`;
      out += `<path d="M ${cx - sW - armW/2},${sleeveY} Q ${cx - sW - armW},${elbowY} ${cx - sW - armW + 2},${wristY} L ${cx - sW + 2},${wristY} Q ${cx - sW},${elbowY} ${cx - sW + armW - 2},${sleeveY} Z" fill="${skin}"/>`;
      out += `<path d="M ${cx + sW + armW/2},${sleeveY} Q ${cx + sW + armW},${elbowY} ${cx + sW + armW - 2},${wristY} L ${cx + sW - 2},${wristY} Q ${cx + sW},${elbowY} ${cx + sW - armW + 2},${sleeveY} Z" fill="${skin}"/>`;
  } else {
      out += `<path d="M ${cx - sW + 2},${y.shoulder} Q ${cx - sW - armW},${elbowY} ${cx - sW - armW + 2},${wristY} L ${cx - sW + 2},${wristY} Q ${cx - sW + 2},${elbowY} ${cx - sW + armW},${y.chest} Z" fill="${armC}" stroke="${armSk}" stroke-width="0.6"/>`;
      out += `<path d="M ${cx + sW - 2},${y.shoulder} Q ${cx + sW + armW},${elbowY} ${cx + sW + armW - 2},${wristY} L ${cx + sW - 2},${wristY} Q ${cx + sW - 2},${elbowY} ${cx + sW - armW},${y.chest} Z" fill="${armC}" stroke="${armSk}" stroke-width="0.6"/>`;
  }
  out += `<ellipse cx="${cx - sW - armW/2 + 2}" cy="${wristY + 6}" rx="4" ry="6" fill="${skin}"/>`;
  out += `<ellipse cx="${cx + sW + armW/2 - 2}" cy="${wristY + 6}" rx="4" ry="6" fill="${skin}"/>`;
  return out;
}

function buildExactLegsShoes(o, cx, y, w, skin) {
  const isSkirt = o.bType === 'skirt' || o.bType === 'dress';
  const pC = o.bType === 'dress' ? o.shirt : o.pants; const pSk = shade(pC, -20);
  const hW = w.hip/2 + 2; const ankW = w.legDown; let out = "";

  if (isSkirt) {
     out += `<path d="M ${cx - 4},${y.crotch} L ${cx - ankW},${y.ankle} L ${cx - 2},${y.ankle} Z" fill="${shade(skin, -10)}"/>`;
     out += `<path d="M ${cx + 4},${y.crotch} L ${cx + ankW},${y.ankle} L ${cx + 2},${y.ankle} Z" fill="${shade(skin, -10)}"/>`;
     const skirtY = y.knee + 10; const skirtW = hW + 10;
     out += `<path d="M ${cx - hW},${y.hip - 5} C ${cx - skirtW},${y.crotch} ${cx - skirtW},${y.knee} ${cx - skirtW - 5},${skirtY} Q ${cx},${skirtY + 8} ${cx + skirtW + 5},${skirtY} C ${cx + skirtW},${y.knee} ${cx + skirtW},${y.crotch} ${cx + hW},${y.hip - 5} Z" fill="${pC}" stroke="${pSk}" stroke-width="0.5"/>`;
     out += `<path d="M ${cx - 5},${y.hip} L ${cx - 8},${skirtY + 2} M ${cx + 5},${y.hip} L ${cx + 8},${skirtY + 2}" stroke="${pSk}" stroke-width="0.6" opacity="0.4"/>`;
  } else {
     out += `<path d="M ${cx - hW},${y.hip - 5} C ${cx - hW - 2},${y.crotch} ${cx - ankW - 4},${y.knee} ${cx - ankW - 6},${y.ankle+2} L ${cx - 2},${y.ankle+2} L ${cx},${y.crotch} Z" fill="${pC}" stroke="${pSk}" stroke-width="0.5"/>`;
     out += `<path d="M ${cx + hW},${y.hip - 5} C ${cx + hW + 2},${y.crotch} ${cx + ankW + 4},${y.knee} ${cx + ankW + 6},${y.ankle+2} L ${cx + 2},${y.ankle+2} L ${cx},${y.crotch} Z" fill="${pC}" stroke="${pSk}" stroke-width="0.5"/>`;
     out += `<path d="M ${cx - ankW/2 - 2},${y.crotch+15} L ${cx - ankW/2 - 4},${y.ankle} M ${cx + ankW/2 + 2},${y.crotch+15} L ${cx + ankW/2 + 4},${y.ankle}" stroke="${pSk}" stroke-width="0.6" opacity="0.4"/>`;
  }

  const sC = o.shoes; const sSk = shade(sC, -20);
  const fL = cx - ankW - 6, fLw = ankW + 8; const fR = cx + 2, fRw = ankW + 8;

  if (o.sType === 'heels') {
     out += `<path d="M ${fL},${y.ankle} Q ${fL - 5},${y.floor} ${fL + fLw - 5},${y.floor} L ${fL + fLw - 2},${y.ankle+5} Z" fill="${sC}" stroke="${sSk}"/><rect x="${fL + fLw - 4}" y="${y.ankle+5}" width="2.5" height="12" fill="${sC}" rx="1"/>`;
     out += `<path d="M ${fR},${y.ankle+5} Q ${fR + 5},${y.floor} ${fR + fRw + 5},${y.floor} L ${fR + fRw},${y.ankle} Z" fill="${sC}" stroke="${sSk}"/><rect x="${fR + 1}" y="${y.ankle+5}" width="2.5" height="12" fill="${sC}" rx="1"/>`;
  } else if (o.sType === 'flats') {
     out += `<path d="M ${fL},${y.ankle} C ${fL - 4},${y.floor+2} ${fL + fLw},${y.floor+2} ${fL + fLw},${y.ankle+2} Q ${fL + fLw/2},${y.ankle+6} ${fL},${y.ankle} Z" fill="${sC}" stroke="${sSk}"/>`;
     out += `<path d="M ${fR},${y.ankle+2} C ${fR},${y.floor+2} ${fR + fRw + 4},${y.floor+2} ${fR + fRw},${y.ankle} Q ${fR + fRw/2},${y.ankle+6} ${fR},${y.ankle+2} Z" fill="${sC}" stroke="${sSk}"/>`;
  } else {
     out += `<path d="M ${fL - 2},${y.ankle} C ${fL - 6},${y.floor} ${fL + fLw},${y.floor} ${fL + fLw},${y.ankle} Z" fill="${sC}" stroke="${sSk}"/>`;
     out += `<path d="M ${fR},${y.ankle} C ${fR},${y.floor} ${fR + fRw + 6},${y.floor} ${fR + fRw + 2},${y.ankle} Z" fill="${sC}" stroke="${sSk}"/>`;
     if (o.sType === 'sneakers') {
        out += `<path d="M ${fL - 4},${y.floor - 3} L ${fL + fLw - 1},${y.floor - 3}" stroke="#ffffff" stroke-width="2.5" opacity="0.8"/>`;
        out += `<path d="M ${fR + 1},${y.floor - 3} L ${fR + fRw + 4},${y.floor - 3}" stroke="#ffffff" stroke-width="2.5" opacity="0.8"/>`;
     }
  }
  return out;
}

function buildFashionHead(skin, sk, hair, cx, y, w, genre) {
  const fW = w.head / 2; const hH = y.chin - y.top; const eyeY = y.top + hH * 0.45; const noseY = y.top + hH * 0.68; const mouthY = y.top + hH * 0.82; let out = "";
  if (genre === 'F') out += `<path d="M ${cx - fW - 2},${y.top + 5} L ${cx - fW - 8},${y.shoulder + 5} Q ${cx},${y.shoulder + 15} ${cx + fW + 8},${y.shoulder + 5} L ${cx + fW + 2},${y.top + 5} Z" fill="${hair}"/>`;
  out += `<path d="M ${cx - fW},${eyeY} Q ${cx - fW},${y.chin} ${cx},${y.chin} Q ${cx + fW},${y.chin} ${cx + fW},${eyeY} L ${cx + fW},${y.top} Q ${cx},${y.top - 5} ${cx - fW},${y.top} Z" fill="${skin}" stroke="${sk}" stroke-width="0.5"/>`;
  out += `<path d="M ${cx-fW},${eyeY} C ${cx-fW-3},${eyeY} ${cx-fW-3},${eyeY+6} ${cx-fW},${eyeY+6} Z" fill="${shade(skin, -10)}"/>`;
  out += `<path d="M ${cx+fW},${eyeY} C ${cx+fW+3},${eyeY} ${cx+fW+3},${eyeY+6} ${cx+fW},${eyeY+6} Z" fill="${shade(skin, -10)}"/>`;
  if (genre === 'M') { out += `<path d="M ${cx - fW},${eyeY - 4} C ${cx - fW - 2},${y.top - 8} ${cx + fW + 2},${y.top - 8} ${cx + fW},${eyeY - 4} Q ${cx},${y.top} ${cx - fW},${eyeY - 4} Z" fill="${hair}"/>`; } 
  else { out += `<path d="M ${cx - fW - 1},${eyeY} Q ${cx - fW - 2},${y.top - 4} ${cx},${y.top - 2} Q ${cx + fW + 2},${y.top - 4} ${cx + fW + 1},${eyeY} Q ${cx + fW/2},${y.top + 4} ${cx},${y.top + 2} Q ${cx - fW/2},${y.top + 4} ${cx - fW - 1},${eyeY} Z" fill="${hair}"/>`; }
  const eyeDist = fW * 0.45; const eyeW = fW * 0.38;    
  out += `<line x1="${cx - eyeDist - eyeW/2}" y1="${eyeY - 4}" x2="${cx - eyeDist + eyeW/2}" y2="${eyeY - 4}" stroke="${hair}" stroke-width="${genre==='F'?1:1.5}" stroke-linecap="round"/>`;
  out += `<line x1="${cx + eyeDist - eyeW/2}" y1="${eyeY - 4}" x2="${cx + eyeDist + eyeW/2}" y2="${eyeY - 4}" stroke="${hair}" stroke-width="${genre==='F'?1:1.5}" stroke-linecap="round"/>`;
  out += `<line x1="${cx - eyeDist - eyeW/2}" y1="${eyeY}" x2="${cx - eyeDist + eyeW/2}" y2="${eyeY}" stroke="${sk}" stroke-width="1.2" stroke-linecap="round"/>`;
  out += `<line x1="${cx + eyeDist - eyeW/2}" y1="${eyeY}" x2="${cx + eyeDist + eyeW/2}" y2="${eyeY}" stroke="${sk}" stroke-width="1.2" stroke-linecap="round"/>`;
  out += `<polyline points="${cx},${eyeY+2} ${cx},${noseY} ${cx + 1.5},${noseY}" fill="none" stroke="${shade(skin, -25)}" stroke-width="0.8" stroke-linejoin="round"/>`;
  out += `<path d="M ${cx - 3.5},${mouthY} Q ${cx},${mouthY + 1.5} ${cx + 3.5},${mouthY}" stroke="${genre === 'F' ? '#c95a4a' : shade(skin, -30)}" stroke-width="${genre === 'F' ? '1.5' : '1'}" fill="none" stroke-linecap="round"/>`;
  return out;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DYNAMIC GENERATOR (Semaine et Garde-Robe Unifi√©e)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generateDays(numDays = 5, isAppending = false) {
  const job = JOBS.find(j => j.id === S.prof) || JOBS[0];
  const temp = ['tropical', 'equatorial', 'semiaride'].includes(S.climat) ? 'hot' : 'cold';
  const bMult = S.budget ? Math.max(0.4, S.budget / 35000) : 1;
  
  let weekStructure = [];
  if (job.code === 'strict') { weekStructure = S.hier >= 2 ? ['formal', 'formal', 'formal', 'formal', 'smart'] : ['formal', 'formal', 'smart', 'formal', 'smart']; } 
  else if (job.code === 'smart') { weekStructure = S.hier >= 2 ? ['formal', 'smart', 'smart', 'formal', 'smart'] : ['smart', 'smart', 'smart', 'smart', 'casual']; } 
  else { weekStructure = S.hier >= 2 ? ['smart', 'casual', 'smart', 'smart', 'casual'] : ['casual', 'casual', 'casual', 'casual', 'casual']; }

  const days = ['LUN', 'MAR', 'MER', 'JEU', 'VEN'];
  
  if (!isAppending) { GENERATED_WEEK = []; WARDROBE_EXTRACT = []; weekOffset = 0; }
  let wid = WARDROBE_EXTRACT.length + 1;

  for (let i=0; i<numDays; i++) {
    const dayOfWeek = i % 5;
    const currentWeekNum = Math.floor((GENERATED_WEEK.length) / 5) + 1;
    const targetType = weekStructure[dayOfWeek];
    
    const o = generateUniqueOutfit(S, targetType, temp, GENERATED_WEEK.length);
    
    const pMain = Math.floor((Math.random() * 6000 + 4000) * bMult / 500) * 500;
    const pAcc  = Math.floor((Math.random() * 2500 + 1500) * bMult / 500) * 500;
    const pShoe = Math.floor((Math.random() * 5000 + 3500) * bMult / 500) * 500;

    const pieces = [];
    
    // Le secret de la non-r√©p√©tition : la CL√â UNIQUE bas√©e sur la couleur hexad√©cimale !
    if (o.tType === 'suit') {
      pieces.push({c:o.jacket, idKey:`v_${o.jacket}`, n:`Veste ${o.n.split(' ')[1]||''}`, p: pMain});
      pieces.push({c:o.pants, idKey:`p_${o.pants}`, n:o.bType==='skirt'?'Jupe tailleur':'Pantalon tailleur', p: pMain});
      pieces.push({c:o.shirt, idKey:`c_${o.shirt}`, n:'Chemise/Blouse', p: pAcc});
    } else if (o.tType === 'blazer') {
      pieces.push({c:o.jacket, idKey:`b_${o.jacket}`, n:`Blazer D√©pareill√©`, p: pMain});
      pieces.push({c:o.pants, idKey:`p_${o.pants}`, n:o.bType==='skirt'?'Jupe':'Pantalon/Chino', p: pMain});
      pieces.push({c:o.shirt, idKey:`c_${o.shirt}`, n:'Chemise/Blouse', p: pAcc});
    } else if (o.tType === 'dress') {
      pieces.push({c:o.shirt, idKey:`r_${o.shirt}`, n:o.n, p: pMain * 2});
    } else {
      pieces.push({c:o.shirt, idKey:`h_${o.shirt}`, n:o.tType==='blouse'?'Blouse fluide':o.tType==='polo'?'Polo':'Chemise', p: pMain});
      pieces.push({c:o.pants, idKey:`b_${o.pants}`, n:o.bType==='skirt'?'Jupe':'Pantalon/Chino', p: pMain});
    }
    pieces.push({c:o.shoes, idKey:`s_${o.shoes}_${o.sType}`, n:o.sType==='heels'?'Talons':o.sType==='flats'?'Ballerines':'Chaussures', p: pShoe});

    let totalDayCost = 0;

    // D√©tection de r√©utilisation R√âELLE (m√™me coupe + m√™me couleur exacte)
    pieces.forEach(p => {
      let existingPiece = WARDROBE_EXTRACT.find(w => w.idKey === p.idKey);
      if(existingPiece) {
        p.r = true; // R√©utilis√©e !
        existingPiece.uses += 1;
      } else {
        p.r = false; // Neuf !
        totalDayCost += p.p;
        WARDROBE_EXTRACT.push({ id:wid++, idKey:p.idKey, ico:getPieceIcon(p.n), n:p.n, cat:getCatFromName(p.n, o), cpp: p.p, uses: 1 });
      }
    });

    GENERATED_WEEK.push({
      day: days[dayOfWeek],
      lbl: currentWeekNum > 1 ? `Semaine ${currentWeekNum} - Jour ${dayOfWeek+1}` : ['Lancement', 'Op√©rationnel', 'Mi-semaine', 'Focus', 'Friday Casual'][dayOfWeek],
      outfitObj: o,
      sc: Math.floor(Math.random() * 10) + 90, 
      cr: Math.floor(Math.random() * 15) + 85,
      co: Math.floor(Math.random() * 15) + 85,
      cpp: totalDayCost.toLocaleString('fr') + ' FCFA',
      pcs: pieces,
      tags: [o.type.toUpperCase(), (o.tType==='suit'||o.tType==='blazer')?'AUTHORITY':o.tType==='dress'?'ELEGANT':'CONFORT', temp.toUpperCase()]
    });
  }
}

function generateMoreDays() {
    generateDays(5, true);
    renderDB();
    toast('‚ö° 5 nouveaux jours g√©n√©r√©s (Garde-robe √©tendue !)');
}

function getPieceIcon(name) {
  name = name.toLowerCase();
  if (name.includes('robe')) return 'üëó';
  if (name.includes('jupe')) return 'ü•ª';
  if (name.includes('talon')) return 'üë†';
  if (name.includes('veste') || name.includes('blazer')) return 'üß•';
  if (name.includes('chemise') || name.includes('blouse')) return 'üëö';
  if (name.includes('pantalon') || name.includes('chino')) return 'üëñ';
  return 'üëû';
}
function getCatFromName(name, o) {
  name = name.toLowerCase();
  if (name.includes('robe')) return 'robe';
  if (name.includes('jupe') || name.includes('pantalon') || name.includes('chino')) return 'bas';
  if (name.includes('talon') || name.includes('chaussure') || name.includes('ballerine')) return 'chaussures';
  return 'haut';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCORING ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function score(){
  const mS=S.morpho?90:50;
  const pS={finance:95,droit:92,gouv:90,conseil:88,sante:82,educ:80,commerce:76,comm:78,tech:72}[S.prof]||70;
  const cS={tropical:88,semiaride:85,equatorial:87,altitude:88}[S.climat]||70;
  const bS=S.budget?Math.min(98,55+S.budget/3000):50;
  const eS=S.teint?90:60; const hB=S.hier*4;
  return{total:Math.min(99,Math.round(mS*.3+pS*.25+cS*.2+bS*.15+eS*.1+hB)),m:mS,p:pS,c:cS,b:bS,e:eS};
}
function rules(){
  const r=[];
  if(S.morpho==='A') r.push({i:'üìê',t:'Morpho A : Hauts clairs et bas fonc√©s pour r√©√©quilibrer la silhouette.'});
  if(S.morpho==='V') r.push({i:'üìê',t:'Morpho V : Hauts fonc√©s pour minimiser la carrure visuellement.'});
  if(S.morpho==='O') r.push({i:'üìê',t:'Morpho O : Favorisation des looks monochromes amincissants.'});
  if(S.hier>=2) r.push({i:'üëë',t:'Niveau Dirigeant : Contraste rehauss√© et couleurs assombries.'});
  if(S.budget>=75000) r.push({i:'üíé',t:'Budget Premium/Luxe simul√© (Soie/Laine Froide).'});
  return r;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initUI(){
  const combos=[
    {m:'A',s:'s5',o:generateUniqueOutfit({genre:'F', morpho:'A', hier:1, budget:150000}, 'formal', 'cold', 1),g:'F', l:'Robe Couture ¬∑ Femme'},
    {m:'H',s:'s3',o:generateUniqueOutfit({genre:'M', morpho:'H', hier:3, budget:150000}, 'formal', 'cold', 2),g:'M', l:'Costume Nuit ¬∑ Homme'},
    {m:'X',s:'s6',o:generateUniqueOutfit({genre:'F', morpho:'X', hier:1, budget:35000}, 'smart', 'hot', 3),g:'F', l:'Chemisier & Jupe ¬∑ Femme'}
  ];
  document.getElementById('spAv').innerHTML=combos.map((c,i)=>
    `<div class="sp-av-wrap" style="animation:rise .7s ${.7+i*.15}s both">
      ${buildAvatar(c.m,c.s,c.o,c.g,138)}
      <div class="sp-av-lbl">${c.l}</div>
    </div>`).join('');

  const stpLbls=['Genre & Morphologie','Teint & Stature','Profession','Budget & Climat','Confirmation'];
  document.getElementById('obStps').innerHTML=stpLbls.map((l,i)=>
    `<div class="ob-stp ${i===0?'cur':''}" id="os${i+1}" onclick="jumpStep(${i+1})">
      <div class="ob-stp-n">${i+1}</div><div class="ob-stp-l">${l}</div>
    </div>`).join('');

  buildMGrid();
  document.getElementById('skRow').innerHTML=SKINS.map(sk=>`<div style="display:flex;flex-direction:column;align-items:center;gap:4px"><div class="sk-sw${sk.id===S.teint?' sel':''}" style="background:${sk.hex}" onclick="setSkin('${sk.id}',this)"></div><div class="sk-lbl">${sk.label}</div></div>`).join('');
  document.getElementById('hiGrid').innerHTML=HIER.map((h,i)=>`<div class="hi-item${i===S.hier?' sel':''}" onclick="setHier(${i},this)"><div class="hi-ico">${h.i}</div><div class="hi-lbl">${h.l}</div></div>`).join('');
  document.getElementById('jGrid').innerHTML=JOBS.map(j=>`<div class="job-card${j.id===S.prof?' sel':''}" onclick="setJob('${j.id}',this)"><div class="job-ico">${j.ico}</div><div><div class="job-n">${j.n}</div><div class="job-c">${j.c}</div></div></div>`).join('');
  document.getElementById('bGrid').innerHTML=BUDGETS.map(b=>`<div class="bud-card${b.v===S.budget?' sel':''}" onclick="setBud(${b.v},this)"><div class="bud-amt">${b.a}</div><div class="bud-unit">FCFA / mois</div><div class="bud-tag ${b.tc}">${b.t}</div></div>`).join('');
  document.getElementById('cGrid').innerHTML=CLIMATS.map(c=>`<div class="cl-card${c.id===S.climat?' sel':''}" onclick="setCl('${c.id}',this)"><div class="cl-ico">${c.ico}</div><div><div class="cl-n">${c.n}</div><div class="cl-c">${c.c}</div></div></div>`).join('');
}

function buildMGrid(){
  const descs={V:'√âpaules larges\nHanches √©troites',A:'Hanches larges\n√âpaules √©troites',H:'√âpaules & hanches\nSimilaires',X:'Sablier\nTaille marqu√©e',O:'Silhouette ronde\nBien r√©partie'};
  const demoOutfit = generateUniqueOutfit(S, 'smart', 'cold', 99);
  document.getElementById('mGrid').innerHTML=Object.keys(MORPH).map(k=>`<div class="m-card${S.morpho===k?' sel':''}" onclick="setMorpho('${k}',this)"><div class="m-av">${buildAvatar(k,S.teint,demoOutfit,S.genre,138)}</div><div class="m-letter">${k}</div><div class="m-desc">${descs[k].replace('\n','<br>')}</div></div>`).join('');
}

function setG(g,btn){ S.genre=g; document.querySelectorAll('.g-btn').forEach(b=>b.classList.remove('on')); btn.classList.add('on'); buildMGrid(); }
function setMorpho(k,el){ document.querySelectorAll('.m-card').forEach(c=>c.classList.remove('sel')); el.classList.add('sel'); S.morpho=k; }
function setSkin(id,el){ document.querySelectorAll('.sk-sw').forEach(s=>s.classList.remove('sel')); el.classList.add('sel'); S.teint=id; buildMGrid();}
function setHier(i,el){ document.querySelectorAll('.hi-item').forEach(h=>h.classList.remove('sel')); el.classList.add('sel'); S.hier=i; }
function setJob(id,el){ document.querySelectorAll('.job-card').forEach(j=>j.classList.remove('sel')); el.classList.add('sel'); S.prof=id; }
function setBud(v,el){ document.querySelectorAll('.bud-card').forEach(b=>b.classList.remove('sel')); el.classList.add('sel'); S.budget=v; }
function setCl(id,el){ document.querySelectorAll('.cl-card').forEach(c=>c.classList.remove('sel')); el.classList.add('sel'); S.climat=id; }

function go(id){ document.querySelectorAll('.scr').forEach(s=>{s.classList.remove('on');s.style.display='';}); document.getElementById(id).classList.add('on'); updProgress(); }
function nxt(){if(curStep<STEPS){if(curStep===STEPS-1)buildRecap();showStep(curStep+1);}}
function prv(){if(curStep>1)showStep(curStep-1);}
function jumpStep(n){if(n<curStep)showStep(n);}
function backToSplash(){go('splash');curStep=1;showStep(1);}
function backToOnboarding(){go('ob');buildRecap();showStep(curStep);}

function showStep(n){
  document.querySelectorAll('.ob-panel').forEach(p=>p.classList.remove('on'));
  document.getElementById(`p${n}`).classList.add('on');
  document.querySelectorAll('.ob-stp').forEach((s,i)=>{
    s.classList.remove('cur','done'); const num=s.querySelector('.ob-stp-n');
    if(i+1===n){s.classList.add('cur');num.textContent=i+1;}
    else if(i+1<n){s.classList.add('done');num.textContent='‚úì';}
    else num.textContent=i+1;
  });
  curStep=n; updProgress();
}
function updProgress(){
  const pct=Math.round(((curStep-1)/(STEPS-1))*100);
  const fill=document.getElementById('obFill'); const pctEl=document.getElementById('obPct');
  if(fill) fill.style.width=pct+'%'; if(pctEl) pctEl.textContent=pct+'%';
}

function buildRecap(){
  const rls=rules();
  const pL=JOBS.find(j=>j.id===S.prof)?.n||'‚Äî'; const cL=CLIMATS.find(c=>c.id===S.climat)?.n||'‚Äî';
  document.getElementById('rcGrid').innerHTML=[
    {l:'Morphologie',v:S.morpho||'‚Äî'},{l:'Genre',v:S.genre==='M'?'Masculin':'F√©minin'},
    {l:'Profession',v:pL},{l:'Budget',v:S.budget?S.budget.toLocaleString('fr')+' FCFA':'‚Äî'},
    {l:'Climat',v:cL},{l:'Niveau',v:HIER[S.hier]?.l||'‚Äî'},
  ].map(r=>`<div class="rc-item"><div class="rc-lbl">${r.l}</div><div class="rc-val">${r.v}</div></div>`).join('');
  document.getElementById('rlList').innerHTML=rls.length?rls.map(r=>`<div class="rl-row"><span class="rl-i">${r.i}</span>${r.t}</div>`).join(''):'<div class="rl-row"><span class="rl-i">‚ÑπÔ∏è</span>Compl√®te ton profil</div>';
}

function launch(){
  generateDays(5, false); // G√©n√®re les 5 premiers jours sans append
  document.getElementById('ob').classList.remove('on');
  document.getElementById('db').classList.add('on');
  renderDB(); toast('‚ö° Syst√®me initialis√© ‚Äî Premi√®re semaine pr√™te');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDB(){
  const sc=score(); const pL=JOBS.find(j=>j.id===S.prof)?.n?.split('/')[0]?.trim()||'Pro';
  document.getElementById('dbUL').textContent=pL; document.getElementById('dbAv').textContent=pL[0];
  
  animN('scN',sc.total);
  const gr=sc.total>=88?'A+':sc.total>=80?'A':sc.total>=72?'B+':'B';
  document.getElementById('scG').textContent=`GRADE ${gr}`; document.getElementById('scG').className=`sc-grade ${sc.total>=88?'sga':sc.total>=75?'sgb':'sgc'}`;
  document.getElementById('scAx').innerHTML=[{n:'Morphologie',v:sc.m,c:'#d4a843'},{n:'Profession',v:sc.p,c:'#79b554'},{n:'Climat',v:sc.c,c:'#5191c9'},{n:'Budget',v:sc.b,c:'#c95a4a'},{n:'Esth√©tique',v:sc.e,c:'#b08830'}].map(a=>`<div class="ax"><div class="ax-top"><span class="ax-n">${a.n}</span><span class="ax-v">${Math.round(a.v)}</span></div><div class="ax-track"><div class="ax-fill" style="width:${a.v}%;background:${a.c}"></div></div></div>`).join('');

  const rc = GENERATED_WEEK.flatMap(d=>d.pcs).filter(p=>p.r).length;
  document.getElementById('dChip').textContent=`${GENERATED_WEEK.length} jours`;
  document.getElementById('rChip').textContent=`${rc} r√©utilisations fluides`;
  document.getElementById('wkCount').textContent=`(${GENERATED_WEEK.length} Jours cumul√©s)`;
  
  document.getElementById('wGrid').innerHTML=GENERATED_WEEK.map((d,i)=>
    `<div class="day-card" onclick="openD(${i})">
      <div class="dc-head"><div class="dc-day">${d.day}</div><div class="dc-score ${d.sc>=88?'dca':'dcg'}">${d.sc}</div></div>
      <div class="av-stage">${buildAvatar(S.morpho||'H',S.teint,d.outfitObj,S.genre,193)}</div>
      <div class="dc-body">
        <div class="dc-outfit-name" title="${d.lbl}">${d.lbl}</div>
        <div class="dc-pieces">
          ${d.pcs.map(p=>`<div class="dc-piece"><div class="dc-dot" style="background:${p.c}"></div><div class="dc-txt" title="${p.n}">${p.n}</div>${p.r?'<span class="dc-r">R√âUTIL.</span>':''}</div>`).join('')}
        </div>
        <div class="dc-tags">${d.tags.map(t=>`<div class="dc-tag">${t}</div>`).join('')}</div>
      </div>
    </div>`).join('');

  document.getElementById('wrdGrid').innerHTML=WARDROBE_EXTRACT.map(w=>
    `<div class="wrd-card" data-cat="${w.cat}">
      <div class="wrd-img" style="background:${shade(w.idKey.split('_')[1], -80)}">${w.ico}</div>
      <div class="wrd-info">
        <div class="wrd-n" title="${w.n}">${w.n}</div>
        <div class="wrd-t">${w.cat.toUpperCase()} - <span style="display:inline-block;width:8px;height:8px;border-radius:2px;background:${w.idKey.split('_')[1]};vertical-align:middle;border:1px solid rgba(255,255,255,0.2)"></span></div>
        <div class="wrd-st"><div class="wrd-cpp">${w.cpp} FCFA/p</div><div class="wrd-uses">√ó${w.uses} port√©</div></div>
      </div>
    </div>`).join('');

  const careerData = S.genre === 'F' ? [
    {l:'Junior', ico:'üå±', outfit:generateUniqueOutfit({genre:'F', morpho:S.morpho, hier:0, budget:15000}, 'casual', 'cold', 10), style:'Propre & Accessible', desc:'Tenues simples, blouses fluides. Id√©al pour d√©buter.'},
    {l:'Manager', ico:'‚≠ê', outfit:generateUniqueOutfit({genre:'F', morpho:S.morpho, hier:1, budget:35000}, 'smart', 'cold', 11), style:'Smart Assum√©', desc:'Jupes structur√©es, talons mod√©r√©s. Marque l\'ascension.'},
    {l:'Directeur',ico:'üíé', outfit:generateUniqueOutfit({genre:'F', morpho:S.morpho, hier:3, budget:150000}, 'formal', 'cold', 12), style:'Authority Dressing', desc:'Tailleur strict. Signaux de leadership forts.'}
  ] : [
    {l:'Junior', ico:'üå±', outfit:generateUniqueOutfit({genre:'M', morpho:S.morpho, hier:0, budget:15000}, 'casual', 'cold', 13), style:'Propre & Accessible', desc:'Polo/Chemise, Chino. Net et confortable.'},
    {l:'Manager', ico:'‚≠ê', outfit:generateUniqueOutfit({genre:'M', morpho:S.morpho, hier:1, budget:35000}, 'smart', 'cold', 14), style:'Smart Assum√©', desc:'Costumes d√©pareill√©s, chemises impeccables.'},
    {l:'Directeur',ico:'üíé', outfit:generateUniqueOutfit({genre:'M', morpho:S.morpho, hier:3, budget:150000}, 'formal', 'cold', 15), style:'Authority Dressing', desc:'Costume structur√© inspirant la confiance.'}
  ];

  document.getElementById('careerCont').innerHTML=careerData.map((c,i)=>`<div style="display:grid;grid-template-columns:88px 1fr;gap:18px;align-items:start;padding:18px;background:var(--s1);border:1.5px solid ${S.hier===i?'var(--gold)':'var(--b1)'};border-radius:var(--r2);margin-bottom:10px;cursor:pointer;background:${S.hier===i?'rgba(212,168,67,.07)':'var(--s1)'};" onclick="highlightCareer(this)"><div style="background:var(--s2);border-radius:var(--r2);padding:8px 4px;border:1px solid var(--b1);text-align:center">${buildAvatar(S.morpho||'H',S.teint,c.outfit,S.genre,96)}</div><div><div style="display:flex;align-items:center;gap:9px;margin-bottom:5px"><span style="font-size:16px">${c.ico}</span><span style="font-family:var(--ftitle);font-size:21px;letter-spacing:.05em">${c.l}</span>${S.hier===i?'<span style="font-size:8px;font-family:var(--fmono);padding:2px 8px;background:var(--golddim);color:var(--gold);border-radius:99px">ACTUEL</span>':''}</div><div style="color:var(--gold);font-family:var(--fmono);font-size:9px;letter-spacing:.1em;margin-bottom:7px">${c.style}</div><div style="font-size:12px;color:var(--t2);font-weight:300;line-height:1.65">${c.desc}</div></div></div>`).join('');
  document.getElementById('ssProf').innerHTML=[{k:'Morphologie',v:S.morpho||'‚Äî'},{k:'Profession',v:pL},{k:'Niveau',v:HIER[S.hier]?.l||'‚Äî'},{k:'Budget/mois',v:S.budget?S.budget.toLocaleString('fr')+' FCFA':'‚Äî'},{k:'Climat',v:CLIMATS.find(c=>c.id===S.climat)?.n||'‚Äî'},{k:'Genre',v:S.genre==='M'?'Masculin':'F√©minin'}].map(s=>`<div class="ss-row"><div class="ss-k">${s.k}</div><div class="ss-v">${s.v}</div></div>`).join('');
  document.getElementById('ssIns').innerHTML=rules().slice(0,4).map(r=>`<div class="insight"><div class="in-i">${r.i}</div>${r.t}</div>`).join('');
  document.getElementById('ssSt').innerHTML=[{k:'Total Jours G√©n√©r√©s',v:`${GENERATED_WEEK.length} j.`},{k:'Taille Garde-Robe',v:`${WARDROBE_EXTRACT.length} pi√®ces distinctes`},{k:'Score Profil Global',v:`${sc.total}/100`}].map(s=>`<div class="ss-row"><div class="ss-k">${s.k}</div><div class="ss-v">${s.v}</div></div>`).join('');
}

function highlightCareer(el){ document.querySelectorAll('#careerCont>div').forEach(d=>{d.style.border='1.5px solid var(--b1)';d.style.background='var(--s1)'}); el.style.border='1.5px solid var(--gold)'; el.style.background='rgba(212,168,67,.07)'; }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DRAWER & UTILITAIRES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openD(idx){
  const d=GENERATED_WEEK[idx];
  document.getElementById('drDay').textContent=`JOUR ${idx+1} ‚Äî ${d.day}`; document.getElementById('drTitle').textContent=d.lbl;
  document.getElementById('drBody').innerHTML=`
    <div class="dr-av-stage">${buildAvatar(S.morpho||'H',S.teint,d.outfitObj,S.genre,272)}</div>
    <div class="dr-metrics">
      <div class="dr-metric"><div class="dr-mv" style="color:var(--gold)">${d.cr}</div><div class="dr-ml">CR√âDIBILIT√â</div></div>
      <div class="dr-metric"><div class="dr-mv" style="color:var(--green)">${d.co}</div><div class="dr-ml">CONFORT CLIM.</div></div>
    </div>
    <div>
      <div style="font-family:var(--fmono);font-size:8px;letter-spacing:.3em;color:var(--t3);text-transform:uppercase;padding-bottom:8px;border-bottom:1px solid var(--b1);margin-bottom:12px">Composition exacte</div>
      ${d.pcs.map(p=>`<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--s2);border-radius:var(--r);border:1px solid var(--b1);margin-bottom:6px">
        <div style="width:14px;height:14px;border-radius:4px;background:${p.c};flex-shrink:0;border:1px solid rgba(255,255,255,0.1)"></div>
        <div style="flex:1;font-size:12px">${p.n}</div>
        ${p.r?'<span style="font-size:8px;font-family:var(--fmono);padding:2px 7px;background:var(--golddim);color:var(--gold);border-radius:4px">D√âJ√Ä PORT√âE</span>':'<span style="font-size:8px;color:var(--t3);font-family:var(--fmono)">NOUVELLE PI√àCE</span>'}
      </div>`).join('')}
    </div>
    <div class="chips">${d.tags.map(t=>`<div class="chip on">${t}</div>`).join('')}</div>`;
  document.getElementById('ov').classList.add('on'); document.getElementById('drw').classList.add('on');
}

function closeD(){ document.getElementById('ov').classList.remove('on'); document.getElementById('drw').classList.remove('on'); }
function dTab(t,el){ document.querySelectorAll('.db-tab').forEach(b=>b.classList.remove('on')); el.classList.add('on'); ['week','wardrobe','career'].forEach(n=>document.getElementById(`t-${n}`).style.display=n===t?'block':'none'); }
function wrdF(cat,el){ document.querySelectorAll('#wrdChips .chip').forEach(c=>c.classList.remove('on')); el.classList.add('on'); document.querySelectorAll('.wrd-card').forEach(c=>c.style.display=cat==='all'||c.dataset.cat===cat?'':'none'); }
function animN(id,target){ let v=0;const el=document.getElementById(id);const s=target/55; const t=setInterval(()=>{v=Math.min(v+s,target);el.textContent=Math.round(v);if(v>=target)clearInterval(t)},16); }
function toast(msg){ const t=document.getElementById('toast');t.textContent=msg;t.classList.add('on'); setTimeout(()=>t.classList.remove('on'),3000); }

initUI();
</script>
</body>
</html>
