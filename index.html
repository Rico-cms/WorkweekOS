<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WorkWeek OS — Avatar System v3</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0b0b09; --s1:#141412; --s2:#1e1e1a; --s3:#272722;
  --b1:#2c2c26; --b2:#3a3a30;
  --gold:#d4a843; --gold2:#b08830; --golddim:rgba(212,168,67,0.13); --goldglow:rgba(212,168,67,0.3);
  --green:#79b554; --blue:#5191c9; --red:#c95a4a;
  --t1:#eee9dd; --t2:#9e9a8a; --t3:#5e5a4e; --t4:#3a3830;
  --r:8px; --r2:14px; --r3:22px;
  --fh:DM Sans; --fmono:Space Mono; --ftitle:Bebas Neue;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{height:100%}
body{font-family:var(--fh),sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:9000;opacity:.02;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)'/%3E%3C/svg%3E")}

/* ─── SCREENS ─── */
.scr{display:none} .scr.on{display:flex;flex-direction:column}
#ob.on{display:grid;grid-template-columns:272px 1fr}
#db.on{display:flex;flex-direction:column}

/* ════ SPLASH ════ */
#splash{min-height:100vh;align-items:center;justify-content:center;position:relative;overflow:hidden}
.sp-grid{position:absolute;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 59px,rgba(212,168,67,.03) 60px),
             repeating-linear-gradient(90deg,transparent,transparent 59px,rgba(212,168,67,.03) 60px)}
.sp-glow{position:absolute;width:700px;height:700px;border-radius:50%;
  background:radial-gradient(circle,rgba(212,168,67,.09) 0%,transparent 70%);
  top:50%;left:50%;transform:translate(-50%,-50%);animation:pulse 5s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.6}50%{transform:translate(-50%,-50%) scale(1.15);opacity:1}}
.sp-inner{position:relative;z-index:1;text-align:center;display:flex;flex-direction:column;align-items:center}
.sp-eyebrow{font-family:var(--fmono);font-size:9px;letter-spacing:.45em;color:var(--gold);text-transform:uppercase;
  opacity:0;animation:rise .7s .2s forwards}
.sp-logo{font-family:var(--ftitle);font-size:clamp(72px,12vw,148px);line-height:.88;letter-spacing:.03em;margin:18px 0 6px;
  opacity:0;animation:rise .8s .4s forwards}
.sp-logo em{color:var(--gold);font-style:normal}
.sp-sub{font-size:13px;color:var(--t2);font-weight:300;letter-spacing:.06em;max-width:340px;line-height:1.6;
  opacity:0;animation:rise .8s .55s forwards}
.sp-avatars{display:flex;gap:16px;margin:48px 0 52px;opacity:0;animation:rise .8s .7s forwards}
.sp-av-wrap{background:var(--s1);border:1px solid var(--b1);border-radius:var(--r2);
  padding:10px 14px 10px;text-align:center;transition:transform .2s,border-color .2s;cursor:default}
.sp-av-wrap:hover{transform:translateY(-4px);border-color:var(--gold)}
.sp-av-lbl{font-family:var(--fmono);font-size:8px;letter-spacing:.12em;color:var(--t3);margin-top:8px}
.sp-cta{padding:15px 54px;background:var(--gold);color:#0b0b09;font-family:var(--fmono);font-size:11px;
  font-weight:700;letter-spacing:.18em;text-transform:uppercase;border:none;cursor:pointer;
  clip-path:polygon(10px 0,100% 0,calc(100% - 10px) 100%,0 100%);
  transition:background .2s,transform .15s,box-shadow .2s;
  opacity:0;animation:rise .8s .85s forwards}
.sp-cta:hover{background:var(--gold2);transform:translateY(-2px);box-shadow:0 10px 28px var(--goldglow)}
@keyframes rise{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* ════ ONBOARDING ════ */
#ob{display:none;min-height:100vh}
#ob.on{display:grid;grid-template-columns:272px 1fr}
.ob-side{background:var(--s1);border-right:1px solid var(--b1);padding:36px 26px;
  display:flex;flex-direction:column;position:sticky;top:0;height:100vh}
.ob-logo{font-family:var(--ftitle);font-size:21px;letter-spacing:.08em;margin-bottom:50px}
.ob-logo em{color:var(--gold);font-style:normal}
.ob-stps{display:flex;flex-direction:column;gap:2px}
.ob-stp{display:flex;align-items:center;gap:12px;padding:10px 13px;border-radius:var(--r);transition:background .2s;cursor:default}
.ob-stp.done{cursor:pointer}
.ob-stp.done:hover{background:rgba(255,255,255,.04)}
.ob-stp.cur{background:var(--golddim)}
.ob-stp-n{width:24px;height:24px;border-radius:50%;border:1.5px solid var(--b2);
  display:flex;align-items:center;justify-content:center;font-family:var(--fmono);font-size:10px;
  color:var(--t3);flex-shrink:0;transition:all .3s}
.ob-stp.cur .ob-stp-n{border-color:var(--gold);color:var(--gold);background:var(--golddim)}
.ob-stp.done .ob-stp-n{background:var(--green);border-color:var(--green);color:#0b0b09;font-size:12px}
.ob-stp-l{font-size:12px;color:var(--t3);transition:color .2s}
.ob-stp.cur .ob-stp-l{color:var(--t1)}
.ob-foot{margin-top:auto;padding-top:24px;border-top:1px solid var(--b1)}
.ob-prog-top{display:flex;justify-content:space-between;font-family:var(--fmono);font-size:9px;
  color:var(--t3);letter-spacing:.1em;margin-bottom:9px}
.ob-track{height:3px;background:var(--s3);border-radius:99px}
.ob-fill{height:3px;background:var(--gold);border-radius:99px;transition:width .5s cubic-bezier(.4,0,.2,1)}
.ob-main{padding:52px 60px;overflow-y:auto}
.ob-panel{display:none}
.ob-panel.on{display:block;animation:rise .35s forwards}
.ob-eye{font-family:var(--fmono);font-size:9px;letter-spacing:.35em;color:var(--gold);
  text-transform:uppercase;margin-bottom:13px}
.ob-ttl{font-family:var(--ftitle);font-size:50px;letter-spacing:.02em;line-height:.93;margin-bottom:8px}
.ob-sub{font-size:13px;color:var(--t2);font-weight:300;margin-bottom:38px;line-height:1.5}

/* Genre toggle */
.g-tog{display:inline-flex;background:var(--s2);border:1px solid var(--b1);
  border-radius:99px;padding:4px;gap:4px;margin-bottom:36px}
.g-btn{padding:8px 28px;border-radius:99px;font-family:var(--fmono);font-size:10px;
  letter-spacing:.12em;cursor:pointer;border:none;background:transparent;color:var(--t2);transition:all .2s}
.g-btn.on{background:var(--gold);color:#0b0b09;font-weight:700}

/* Morpho grid */
.m-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:36px}
.m-card{border:2px solid var(--b1);border-radius:var(--r2);background:var(--s1);
  cursor:pointer;transition:all .22s;overflow:hidden;position:relative;padding-bottom:14px}
.m-card:hover{border-color:var(--gold2);transform:translateY(-3px)}
.m-card.sel{border-color:var(--gold);background:rgba(212,168,67,.06)}
.m-card.sel::after{content:'✓';position:absolute;top:8px;right:8px;width:18px;height:18px;
  background:var(--gold);color:#0b0b09;border-radius:50%;font-size:9px;font-weight:700;
  display:flex;align-items:center;justify-content:center}
.m-av{height:148px;display:flex;align-items:flex-end;justify-content:center;padding:8px 6px 0}
.m-letter{font-family:var(--ftitle);font-size:26px;color:var(--gold);text-align:center;
  margin:6px 0 3px;letter-spacing:.05em}
.m-desc{font-size:9px;color:var(--t2);text-align:center;line-height:1.55;
  padding:0 8px;font-family:var(--fmono)}

/* Skin */
.sk-row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:32px}
.sk-sw{width:46px;height:46px;border-radius:50%;cursor:pointer;border:3px solid transparent;
  transition:all .2s}
.sk-sw:hover{transform:scale(1.12)}
.sk-sw.sel{border-color:var(--gold);box-shadow:0 0 0 3px var(--golddim)}
.sk-lbl{font-size:9px;color:var(--t3);font-family:var(--fmono);text-align:center;margin-top:5px;letter-spacing:.06em}

/* Slider */
.sl-blk{margin-bottom:28px}
.sl-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:11px}
.sl-n{font-size:10px;font-family:var(--fmono);letter-spacing:.15em;color:var(--t2);text-transform:uppercase}
.sl-v{font-family:var(--ftitle);font-size:21px;color:var(--gold);letter-spacing:.05em}
input[type=range]{-webkit-appearance:none;width:100%;height:4px;background:var(--s3);
  border-radius:99px;outline:none;cursor:pointer}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;
  border-radius:50%;background:var(--gold);border:3px solid var(--bg);cursor:pointer;
  box-shadow:0 0 10px var(--goldglow);transition:box-shadow .2s;margin-top:-8px}
input[type=range]::-webkit-slider-thumb:hover{box-shadow:0 0 20px var(--goldglow)}

/* Hier */
.hi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:30px}
.hi-item{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r);
  padding:14px 8px;cursor:pointer;text-align:center;transition:all .2s}
.hi-item:hover{border-color:var(--gold2)} .hi-item.sel{border-color:var(--gold);background:var(--golddim)}
.hi-ico{font-size:20px;margin-bottom:6px}
.hi-lbl{font-size:9px;font-family:var(--fmono);color:var(--t2);letter-spacing:.05em}

/* Job */
.job-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:36px}
.job-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  padding:18px 15px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:12px}
.job-card:hover{border-color:var(--gold2)} .job-card.sel{border-color:var(--gold);background:var(--golddim)}
.job-ico{font-size:22px;flex-shrink:0}
.job-n{font-size:13px;font-weight:500}
.job-c{font-size:10px;color:var(--t2);font-family:var(--fmono);margin-top:3px}

/* Budget */
.bud-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:28px}
.bud-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  padding:20px 12px 16px;cursor:pointer;transition:all .2s;text-align:center}
.bud-card:hover{border-color:var(--gold2)} .bud-card.sel{border-color:var(--gold);background:var(--golddim)}
.bud-amt{font-family:var(--ftitle);font-size:29px;color:var(--gold)}
.bud-unit{font-size:9px;color:var(--t2);font-family:var(--fmono);margin-top:2px}
.bud-tag{display:inline-block;margin-top:9px;padding:3px 8px;border-radius:4px;
  font-size:8px;font-family:var(--fmono);letter-spacing:.1em}
.tg{background:rgba(121,181,84,.15);color:var(--green)} .ta{background:var(--golddim);color:var(--gold)}

/* Climat */
.cl-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:36px}
.cl-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  padding:18px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:14px}
.cl-card:hover{border-color:var(--gold2)} .cl-card.sel{border-color:var(--gold);background:var(--golddim)}
.cl-ico{font-size:28px}
.cl-n{font-size:13px;font-weight:500}
.cl-c{font-size:10px;color:var(--t2);font-family:var(--fmono);margin-top:3px}

/* Recap */
.rc-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:26px}
.rc-item{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r);padding:15px 17px}
.rc-lbl{font-size:9px;font-family:var(--fmono);letter-spacing:.2em;color:var(--t2);
  text-transform:uppercase;margin-bottom:5px}
.rc-val{font-family:var(--ftitle);font-size:21px;color:var(--gold);letter-spacing:.05em}
.rules-box{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r2);
  padding:20px 22px;margin-bottom:34px}
.rl-title{font-family:var(--fmono);font-size:9px;letter-spacing:.25em;color:var(--t2);
  text-transform:uppercase;margin-bottom:14px}
.rl-row{display:flex;align-items:flex-start;gap:10px;padding:8px 0;
  border-bottom:1px solid rgba(255,255,255,.04);font-size:12px;color:var(--t2);line-height:1.5}
.rl-row:last-child{border-bottom:none}
.rl-i{flex-shrink:0;font-size:13px}

/* Nav btns */
.ob-nav{display:flex;gap:10px;padding-top:6px}
.btn-p{padding:13px 36px;background:var(--gold);color:#0b0b09;font-family:var(--fmono);
  font-size:10px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;
  border:none;border-radius:var(--r);cursor:pointer;transition:all .2s}
.btn-p:hover{background:var(--gold2);transform:translateY(-1px);box-shadow:0 6px 18px var(--goldglow)}
.btn-s{padding:13px 22px;background:transparent;border:1.5px solid var(--b2);color:var(--t2);
  font-family:var(--fmono);font-size:10px;letter-spacing:.1em;text-transform:uppercase;
  border-radius:var(--r);cursor:pointer;transition:all .2s}
.btn-s:hover{border-color:var(--t2);color:var(--t1)}
.btn-launch{padding:15px 50px;background:linear-gradient(135deg,var(--green),#5a8f3a);color:#0b0b09;
  font-family:var(--fmono);font-size:11px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;
  border:none;border-radius:var(--r);cursor:pointer;transition:all .2s}
.btn-launch:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(121,181,84,.3)}

/* ════ DASHBOARD ════ */
#db{display:none;flex-direction:column;min-height:100vh}
#db.on{display:flex}
.db-bar{display:flex;align-items:center;justify-content:space-between;padding:15px 36px;
  border-bottom:1px solid var(--b1);background:rgba(11,11,9,.92);backdrop-filter:blur(16px);
  position:sticky;top:0;z-index:100}
.db-logo{font-family:var(--ftitle);font-size:21px;letter-spacing:.08em}
.db-logo em{color:var(--gold);font-style:normal}
.db-tabs{display:flex;gap:4px}
.db-tab{padding:7px 18px;border-radius:99px;font-family:var(--fmono);font-size:10px;
  letter-spacing:.08em;cursor:pointer;border:none;background:transparent;color:var(--t2);transition:all .2s}
.db-tab.on{background:var(--s2);color:var(--t1);border:1px solid var(--b1)}
.db-tab:hover:not(.on){color:var(--t1)}
.db-usr{display:flex;align-items:center;gap:10px;font-size:12px;color:var(--t2)}
.db-av{width:33px;height:33px;border-radius:50%;background:var(--gold);color:#0b0b09;
  display:flex;align-items:center;justify-content:center;font-family:var(--ftitle);font-size:15px}
.db-body{flex:1;display:grid;grid-template-columns:1fr 336px;min-height:0}
.db-main{padding:34px 40px;overflow-y:auto}
.db-side{border-left:1px solid var(--b1);padding:26px 22px;overflow-y:auto}

/* Score card */
.sc-card{background:var(--s1);border:1px solid var(--b1);border-radius:var(--r2);
  padding:26px 30px;margin-bottom:26px;position:relative;overflow:hidden}
.sc-card::before{content:'';position:absolute;top:-50px;right:-50px;width:200px;height:200px;
  background:radial-gradient(circle,rgba(212,168,67,.1),transparent 70%);pointer-events:none}
.sc-lbl{font-size:9px;font-family:var(--fmono);letter-spacing:.22em;color:var(--t3);
  text-transform:uppercase;margin-bottom:6px}
.sc-top{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:20px}
.sc-n{font-family:var(--ftitle);font-size:86px;line-height:.9;color:var(--gold);letter-spacing:.02em}
.sc-grade{padding:5px 14px;border-radius:99px;font-family:var(--fmono);font-size:10px;font-weight:700;align-self:flex-start}
.sga{background:rgba(121,181,84,.15);color:var(--green)}
.sgb{background:var(--golddim);color:var(--gold)}
.sgc{background:rgba(81,145,201,.15);color:var(--blue)}
.sc-axes{display:grid;grid-template-columns:1fr 1fr;gap:10px 30px}
.ax{display:flex;flex-direction:column;gap:5px}
.ax-top{display:flex;justify-content:space-between;font-size:10px}
.ax-n{color:var(--t3);font-family:var(--fmono);letter-spacing:.04em}
.ax-v{color:var(--t2);font-family:var(--fmono)}
.ax-track{height:3px;background:var(--s3);border-radius:99px}
.ax-fill{height:3px;border-radius:99px;transition:width 1.2s cubic-bezier(.4,0,.2,1)}

/* Section title */
.sec-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.sec-ttl{font-family:var(--ftitle);font-size:28px;letter-spacing:.03em}
.chips{display:flex;gap:7px;flex-wrap:wrap}
.chip{padding:5px 13px;border-radius:99px;font-size:10px;font-family:var(--fmono);
  letter-spacing:.05em;cursor:pointer;border:1px solid var(--b2);background:transparent;
  color:var(--t2);transition:all .2s}
.chip:hover,.chip.on{background:var(--golddim);border-color:var(--gold);color:var(--gold)}

/* Week grid */
.wk-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
.day-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  overflow:hidden;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1)}
.day-card:hover{border-color:var(--gold);transform:translateY(-4px);
  box-shadow:0 18px 44px rgba(0,0,0,.55)}
.dc-head{padding:11px 13px;display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid var(--b1)}
.dc-day{font-family:var(--ftitle);font-size:17px;letter-spacing:.06em}
.dc-score{font-family:var(--fmono);font-size:9px;font-weight:700;padding:3px 8px;border-radius:99px}
.dca{background:var(--golddim);color:var(--gold)}
.dcg{background:rgba(121,181,84,.18);color:var(--green)}

/* Avatar stage */
.av-stage{height:195px;background:linear-gradient(175deg,var(--s2) 0%,var(--s3) 100%);
  display:flex;align-items:flex-end;justify-content:center;position:relative;overflow:hidden}
.av-stage::after{content:'';position:absolute;bottom:0;left:0;right:0;height:45px;
  background:linear-gradient(to top,var(--s1) 0%,transparent 100%);z-index:2;pointer-events:none}
.av-stage svg{position:relative;z-index:1}
/* shadow under feet */
.av-stage::before{content:'';position:absolute;bottom:12px;left:50%;transform:translateX(-50%);
  width:50px;height:8px;background:rgba(0,0,0,.35);border-radius:50%;z-index:1;filter:blur(4px)}

.dc-body{padding:13px}
.dc-outfit-name{font-size:11px;font-weight:600;margin-bottom:8px;letter-spacing:.02em}
.dc-pieces{display:flex;flex-direction:column;gap:5px}
.dc-piece{display:flex;align-items:center;gap:7px;font-size:11px;color:var(--t2)}
.dc-dot{width:7px;height:7px;border-radius:2px;flex-shrink:0}
.dc-txt{flex:1;font-size:10.5px}
.dc-r{font-size:8px;font-family:var(--fmono);padding:1px 5px;border-radius:3px;
  background:var(--golddim);color:var(--gold);white-space:nowrap}
.dc-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:9px}
.dc-tag{font-size:8px;font-family:var(--fmono);padding:2px 7px;border-radius:4px;
  background:var(--s3);color:var(--t3);letter-spacing:.05em}

/* Sidebar */
.ss-sec{margin-bottom:26px}
.ss-t{font-family:var(--fmono);font-size:8px;letter-spacing:.3em;color:var(--t3);
  text-transform:uppercase;padding-bottom:9px;border-bottom:1px solid var(--b1);margin-bottom:13px}
.ss-row{display:flex;justify-content:space-between;align-items:center;
  padding:7px 0;border-bottom:1px solid rgba(255,255,255,.025);font-size:12px}
.ss-k{color:var(--t2)} .ss-v{font-family:var(--fmono);font-size:10px;color:var(--t1)}
.insight{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r);
  padding:11px 13px;margin-bottom:7px;font-size:11.5px;color:var(--t2);
  display:flex;gap:8px;align-items:flex-start;line-height:1.5}
.in-i{font-size:13px;flex-shrink:0;margin-top:1px}

/* Drawer */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:200;opacity:0;
  pointer-events:none;transition:opacity .3s;backdrop-filter:blur(8px)}
.overlay.on{opacity:1;pointer-events:all}
.drawer{position:fixed;right:0;top:0;bottom:0;width:440px;background:var(--s1);
  border-left:1px solid var(--b1);z-index:201;transform:translateX(100%);
  transition:transform .38s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column}
.drawer.on{transform:translateX(0)}
.dr-head{padding:20px 24px;border-bottom:1px solid var(--b1);display:flex;
  justify-content:space-between;align-items:center;flex-shrink:0}
.dr-close{width:29px;height:29px;border-radius:50%;background:var(--s2);border:1px solid var(--b1);
  cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;
  color:var(--t2);transition:all .2s}
.dr-close:hover{color:var(--t1);border-color:var(--t2)}
.dr-body{flex:1;overflow-y:auto;padding:22px 24px;display:flex;flex-direction:column;gap:20px}
.dr-av-stage{background:linear-gradient(170deg,var(--s2),var(--s3));border-radius:var(--r2);
  border:1px solid var(--b1);height:280px;display:flex;align-items:flex-end;
  justify-content:center;overflow:hidden;position:relative}
.dr-av-stage::after{content:'';position:absolute;inset:0;
  background:linear-gradient(to top,var(--s2) 0%,transparent 45%);pointer-events:none}
.dr-av-stage::before{content:'';position:absolute;bottom:14px;left:50%;transform:translateX(-50%);
  width:60px;height:10px;background:rgba(0,0,0,.3);border-radius:50%;z-index:1;filter:blur(5px)}
.dr-av-stage svg{position:relative;z-index:2}
.dr-metrics{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.dr-metric{background:var(--s2);border:1px solid var(--b1);border-radius:var(--r);
  padding:14px;text-align:center}
.dr-mv{font-family:var(--ftitle);font-size:32px}
.dr-ml{font-size:9px;font-family:var(--fmono);color:var(--t3);letter-spacing:.12em;margin-top:2px}

/* Wardrobe */
.wrd-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:13px;margin-top:18px}
.wrd-card{background:var(--s1);border:1.5px solid var(--b1);border-radius:var(--r2);
  overflow:hidden;cursor:pointer;transition:all .2s}
.wrd-card:hover{border-color:var(--gold2);transform:translateY(-2px)}
.wrd-img{height:100px;background:var(--s2);display:flex;align-items:center;
  justify-content:center;border-bottom:1px solid var(--b1);font-size:44px}
.wrd-info{padding:11px 13px}
.wrd-n{font-size:12px;font-weight:500;margin-bottom:2px}
.wrd-t{font-size:9px;color:var(--t3);font-family:var(--fmono)}
.wrd-st{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.wrd-cpp{font-size:10px;font-family:var(--fmono);color:var(--green)}
.wrd-uses{font-size:9px;color:var(--t3)}

/* Toast */
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%) translateY(10px);
  background:var(--s1);border:1px solid var(--gold);color:var(--gold);padding:10px 22px;
  border-radius:99px;font-family:var(--fmono);font-size:10px;letter-spacing:.08em;
  z-index:9001;opacity:0;pointer-events:none;transition:all .3s}
.toast.on{opacity:1;transform:translateX(-50%) translateY(0)}

@media(max-width:1100px){
  #ob.on{grid-template-columns:1fr} .ob-side{display:none} .ob-main{padding:36px 26px}
  .m-grid{grid-template-columns:repeat(3,1fr)} .wk-grid{grid-template-columns:1fr 1fr}
  .db-body{grid-template-columns:1fr} .db-side{display:none}
}
</style>
</head>
<body>

<!-- ══════════ SPLASH ══════════ -->
<div id="splash" class="scr on">
  <div class="sp-grid"></div>
  <div class="sp-glow"></div>
  <div class="sp-inner">
    <p class="sp-eyebrow">Système Vestimentaire — Afrique Urbaine</p>
    <h1 class="sp-logo">WORK<em>WEEK</em><br>OS</h1>
    <p class="sp-sub">Moteur de décision vestimentaire professionnelle intelligent</p>
    <div class="sp-avatars" id="spAv"></div>
    <button class="sp-cta" onclick="go('ob')">Initialiser le système →</button>
  </div>
</div>

<!-- ══════════ ONBOARDING ══════════ -->
<div id="ob" class="scr">
  <div class="ob-side">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:50px">
      <button onclick="backToSplash()" title="Retour à l'accueil"
        style="width:28px;height:28px;border-radius:50%;background:transparent;border:1.5px solid var(--b2);
               color:var(--t3);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;
               transition:all .2s;flex-shrink:0;line-height:1"
        onmouseover="this.style.borderColor='var(--t2)';this.style.color='var(--t1)'"
        onmouseout="this.style.borderColor='var(--b2)';this.style.color='var(--t3)'">←</button>
      <div class="ob-logo" style="margin-bottom:0">Work<em>Week</em> OS</div>
    </div>
    <div class="ob-stps" id="obStps"></div>
    <div class="ob-foot">
      <div class="ob-prog-top"><span>PROGRESSION</span><span id="obPct">0%</span></div>
      <div class="ob-track"><div class="ob-fill" id="obFill" style="width:0%"></div></div>
    </div>
  </div>
  <div class="ob-main">

    <!-- P1: Genre + Morphologie -->
    <div class="ob-panel on" id="p1">
      <div class="ob-eye">Étape 01 — Profil Morphologique</div>
      <h2 class="ob-ttl">Genre &<br>Morphologie</h2>
      <p class="ob-sub">Poids 30% · Les coupes et silhouettes adaptées à ton corps</p>
      <div class="g-tog" id="gTog">
        <button class="g-btn on" onclick="setG('M',this)">MASCULIN</button>
        <button class="g-btn" onclick="setG('F',this)">FÉMININ</button>
      </div>
      <div class="m-grid" id="mGrid"></div>
      <div class="ob-nav"><button class="btn-p" onclick="nxt()">Continuer →</button></div>
    </div>

    <!-- P2: Teint + Taille + Niveau -->
    <div class="ob-panel" id="p2">
      <div class="ob-eye">Étape 02 — Apparence & Stature</div>
      <h2 class="ob-ttl">Teint &<br>Taille</h2>
      <p class="ob-sub">Personnalise les recommandations chromatiques et de coupe</p>
      <div style="margin-bottom:30px">
        <div class="sl-n" style="margin-bottom:13px">Teint de peau</div>
        <div class="sk-row" id="skRow"></div>
      </div>
      <div class="sl-blk">
        <div class="sl-hd"><span class="sl-n">Taille</span><span class="sl-v" id="tlDisp">175 cm</span></div>
        <input type="range" min="150" max="200" value="175" oninput="S.taille=+this.value;document.getElementById('tlDisp').textContent=this.value+' cm'">
      </div>
      <div class="sl-n" style="margin-bottom:11px">Niveau hiérarchique</div>
      <div class="hi-grid" id="hiGrid"></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">← Retour</button>
        <button class="btn-p" onclick="nxt()">Continuer →</button>
      </div>
    </div>

    <!-- P3: Profession -->
    <div class="ob-panel" id="p3">
      <div class="ob-eye">Étape 03 — Contexte Professionnel</div>
      <h2 class="ob-ttl">Secteur<br>d'activité</h2>
      <p class="ob-sub">Poids 25% · Détermine les codes vestimentaires applicables</p>
      <div class="job-grid" id="jGrid"></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">← Retour</button>
        <button class="btn-p" onclick="nxt()">Continuer →</button>
      </div>
    </div>

    <!-- P4: Budget + Climat -->
    <div class="ob-panel" id="p4">
      <div class="ob-eye">Étape 04 — Contraintes</div>
      <h2 class="ob-ttl">Budget &<br>Climat</h2>
      <p class="ob-sub">Optimisation réelle selon tes ressources et ton environnement</p>
      <div style="margin-bottom:28px">
        <div class="sl-n" style="margin-bottom:12px">Budget mensuel tenues</div>
        <div class="bud-grid" id="bGrid"></div>
      </div>
      <div class="sl-n" style="margin-bottom:12px">Climat de ta ville</div>
      <div class="cl-grid" id="cGrid"></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">← Retour</button>
        <button class="btn-p" onclick="nxt()">Continuer →</button>
      </div>
    </div>

    <!-- P5: Recap -->
    <div class="ob-panel" id="p5">
      <div class="ob-eye">Étape 05 — Initialisation</div>
      <h2 class="ob-ttl">Profil<br>Configuré</h2>
      <p class="ob-sub">Le moteur calcule ton score et génère ta semaine optimisée</p>
      <div class="rc-grid" id="rcGrid"></div>
      <div class="rules-box"><div class="rl-title">Règles moteur activées</div><div id="rlList"></div></div>
      <div class="ob-nav">
        <button class="btn-s" onclick="prv()">← Retour</button>
        <button class="btn-launch" onclick="launch()">⚡ Lancer WorkWeek OS</button>
      </div>
    </div>
  </div>
</div>

<!-- ══════════ DASHBOARD ══════════ -->
<div id="db" class="scr">
  <div class="db-bar">
    <div style="display:flex;align-items:center;gap:12px">
      <button onclick="backToOnboarding()" title="Modifier le profil"
        style="display:flex;align-items:center;gap:7px;padding:7px 14px;border-radius:99px;
               background:transparent;border:1.5px solid var(--b2);color:var(--t2);
               font-family:var(--fmono);font-size:9px;letter-spacing:.1em;cursor:pointer;
               transition:all .2s"
        onmouseover="this.style.borderColor='var(--gold)';this.style.color='var(--gold)'"
        onmouseout="this.style.borderColor='var(--b2)';this.style.color='var(--t2)'">
        <span>←</span> PROFIL
      </button>
      <div class="db-logo">Work<em>Week</em> OS</div>
    </div>
    <div class="db-tabs">
      <button class="db-tab on" onclick="dTab('week',this)">Semaine</button>
      <button class="db-tab" onclick="dTab('wardrobe',this)">Garde-robe</button>
      <button class="db-tab" onclick="dTab('career',this)">Carrière</button>
    </div>
    <div class="db-usr"><span id="dbUL"></span><div class="db-av" id="dbAv"></div></div>
  </div>
  <div class="db-body">
    <div class="db-main">
      <div id="t-week">
        <div class="sc-card">
          <div class="sc-lbl">Indice de Crédibilité Visuelle</div>
          <div class="sc-top">
            <div class="sc-n" id="scN">—</div>
            <div class="sc-grade" id="scG"></div>
          </div>
          <div class="sc-axes" id="scAx"></div>
        </div>
        <div class="sec-hd">
          <div class="sec-ttl">Semaine Optimisée</div>
          <div class="chips"><div class="chip on">5 jours</div><div class="chip" id="rChip">— réutilisées</div></div>
        </div>
        <div class="wk-grid" id="wGrid"></div>
      </div>
      <div id="t-wardrobe" style="display:none">
        <div class="sec-hd">
          <div class="sec-ttl">Garde-robe</div>
          <div class="chips" id="wrdChips">
            <div class="chip on" onclick="wrdF('all',this)">Tout</div>
            <div class="chip" onclick="wrdF('haut',this)">Hauts</div>
            <div class="chip" onclick="wrdF('bas',this)">Bas</div>
            <div class="chip" onclick="wrdF('chaussures',this)">Chaussures</div>
          </div>
        </div>
        <div class="wrd-grid" id="wrdGrid"></div>
      </div>
      <div id="t-career" style="display:none">
        <div class="sec-ttl" style="margin-bottom:22px">Évolution de Style</div>
        <div id="careerCont"></div>
      </div>
    </div>
    <div class="db-side">
      <div class="ss-sec"><div class="ss-t">Profil actif</div><div id="ssProf"></div></div>
      <div class="ss-sec"><div class="ss-t">Insights moteur</div><div id="ssIns"></div></div>
      <div class="ss-sec"><div class="ss-t">Stats garde-robe</div><div id="ssSt"></div></div>
    </div>
  </div>
</div>

<div class="overlay" id="ov" onclick="closeD()"></div>
<div class="drawer" id="drw">
  <div class="dr-head">
    <div>
      <div style="font-family:var(--fmono);font-size:9px;color:var(--t3);letter-spacing:.25em;text-transform:uppercase;margin-bottom:3px" id="drDay"></div>
      <div style="font-family:var(--ftitle);font-size:24px;letter-spacing:.05em" id="drTitle"></div>
    </div>
    <div class="dr-close" onclick="closeD()">×</div>
  </div>
  <div class="dr-body" id="drBody"></div>
</div>
<div class="toast" id="toast"></div>

<script>
// ════════════════════════════════════════════════════════
//  STATE
// ════════════════════════════════════════════════════════
const S = { genre:'M', morpho:'H', teint:'brown', taille:175, hier:1, prof:null, budget:null, climat:null };
let curStep = 1;
const STEPS = 5;

// ════════════════════════════════════════════════════════
//  SKIN PALETTE
// ════════════════════════════════════════════════════════
const SKINS = [
  {id:'s1', hex:'#FDDBB4', stroke:'#e8b88a', label:'Clair'},
  {id:'s2', hex:'#E8A87C', stroke:'#d09060', label:'Beige'},
  {id:'s3', hex:'#C97A45', stroke:'#a85e30', label:'Moyen'},
  {id:'s4', hex:'#A05C2A', stroke:'#844a20', label:'Olive'},
  {id:'s5', hex:'#7A3F1A', stroke:'#60300e', label:'Brun'},
  {id:'s6', hex:'#3E1E0A', stroke:'#2a1406', label:'Foncé'},
];
const skinHex = id => (SKINS.find(s=>s.id===id)||SKINS[4]).hex;
const skinStroke = id => (SKINS.find(s=>s.id===id)||SKINS[4]).stroke;

// ════════════════════════════════════════════════════════
//  ██████████  AVATAR ENGINE  ██████████
//  Cartoon épuré — corps entier
//  ViewBox: 0 0 80 180, tête grande, proportions stylisées
// ════════════════════════════════════════════════════════

/*
  Architecture en couches:
  1. Jambes / chaussures
  2. Corps / torse (vêtement bas)
  3. Bras (skin)
  4. Torse haut (vêtement)
  5. Tête + cheveux
  6. Détails visage

  Morphologie → modifie épaules (sw), hanches (hw), taille (tw)
*/

const MORPH = {
  V: {sw:1.28, hw:0.82, tw:0.90},
  A: {sw:0.82, hw:1.25, tw:0.95},
  H: {sw:1.05, hw:1.05, tw:1.05},
  X: {sw:1.18, hw:1.15, tw:0.74},
  O: {sw:1.00, hw:1.00, tw:1.22},
};

// Couleur de cheveux selon teint (naturellement foncée pour teints africains)
const HAIR_C = { s1:'#4a2e12', s2:'#2e1808', s3:'#1a0c04', s4:'#120802', s5:'#0a0402', s6:'#080402' };

// Teintes shadow pour vêtements
const shade=(hex,n)=>{if(!hex||hex[0]!='#')return hex||'#888';const r=parseInt(hex.slice(1),16);const R=Math.min(255,Math.max(0,(r>>16)+n)),G=Math.min(255,Math.max(0,((r>>8)&255)+n)),B=Math.min(255,Math.max(0,(r&255)+n));return '#'+((R<<16)|(G<<8)|B).toString(16).padStart(6,'0')};

/**
 * buildAvatar(morpho, skinId, outfit, genre, pxH)
 * Returns SVG string — cartoon épuré
 */
function buildAvatar(morpho, skinId, outfit, genre='M', pxH=180) {
  const m = MORPH[morpho] || MORPH.H;
  const skin = skinHex(skinId);
  const sk   = skinStroke(skinId);
  const hair = HAIR_C[skinId] || '#1a0c04';
  const o    = OUTFITS[outfit] || OUTFITS.smart_kaki;

  // Viewbox constants — tout est relatif à cela
  const VW=80, VH=180;
  const cx=40;

  // Corps — mesures de base
  const headR=14;      // rayon tête
  const headCY=18;     // centre tête Y
  const neckH=8;
  const neckW=7;
  const shoulderY=headCY+headR+neckH; // ~40

  // Torse
  const sw = m.sw*20; // demi-largeur épaule depuis cx
  const tw = m.tw*12; // demi-largeur taille
  const hw = m.hw*16; // demi-largeur hanche
  const torsoB = shoulderY+55; // bas torse/ceinture ~95

  // Jambes
  const legTop = torsoB;
  const kneeY  = legTop+38; // ~133
  const ankleY = legTop+62; // ~157
  const fH=10; // pied hauteur

  const lLegX = cx-hw+4; // x ext jambe gauche
  const rLegX = cx+hw-4; // x ext jambe droite
  const iLeg  = cx-7;    // séparation intérieure jambe gauche
  const iLegR = cx+7;

  const svgW = Math.round(pxH * VW/VH);
  const svgH = pxH;

  const layers = [];

  // ── 1. CHAUSSURES ──
  layers.push(buildShoes(o.shoes, cx, hw, ankleY, fH, VW));

  // ── 2. JAMBES (pantalon) ──
  layers.push(buildPants(o, cx, hw, tw, legTop, kneeY, ankleY));

  // ── 3. BRAS (derrière torse) ──
  layers.push(buildArms(skin, sk, o, cx, sw, tw, shoulderY, torsoB, o.type));

  // ── 4. TORSE (chemise/veste) ──
  layers.push(buildTorso(o, cx, sw, tw, hw, shoulderY, torsoB, neckW, skin));

  // ── 5. TÊTE ──
  layers.push(buildHead(skin, sk, hair, cx, headCY, headR, genre));

  return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${VW} ${VH}" width="${svgW}" height="${svgH}">
    ${layers.join('')}
  </svg>`;
}

function buildShoes(color, cx, hw, ankleY, fH, VW) {
  const lx = cx-hw+4;
  const rx = cx+4;
  const lw = 16, rw = 16;
  const sc = shade(color,-15);
  return `
  <!-- Chaussures -->
  <path d="M${lx},${ankleY} L${lx-2},${ankleY+fH} Q${lx+lw/2},${ankleY+fH+3} ${lx+lw},${ankleY+fH} L${lx+lw},${ankleY}Z"
        fill="${color}" stroke="${sc}" stroke-width=".6"/>
  <path d="M${rx},${ankleY} L${rx-2},${ankleY+fH} Q${rx+rw/2},${ankleY+fH+3} ${rx+rw},${ankleY+fH} L${rx+rw},${ankleY}Z"
        fill="${color}" stroke="${sc}" stroke-width=".6"/>
  <!-- Reflet chaussure -->
  <path d="M${lx+1},${ankleY+1} Q${lx+lw/2},${ankleY+2} ${lx+lw-2},${ankleY+2}" stroke="rgba(255,255,255,.18)" stroke-width=".8" fill="none" stroke-linecap="round"/>
  <path d="M${rx+1},${ankleY+1} Q${rx+rw/2},${ankleY+2} ${rx+rw-2},${ankleY+2}" stroke="rgba(255,255,255,.18)" stroke-width=".8" fill="none" stroke-linecap="round"/>`;
}

function buildPants(o, cx, hw, tw, legTop, kneeY, ankleY) {
  const pc = o.pants;
  const ps = shade(pc,-20);
  // forme pantalon : trapèze hanche→genou→cheville
  // jambe gauche
  const llx  = cx-hw+3, llix = cx-7;
  // jambe droite
  const rlx  = cx+7,   rrx  = cx+hw-3;
  // cheville
  const lavX  = cx-hw+6, lavXi = cx-5;
  const ravX  = cx+5,   ravXo  = cx+hw-6;

  return `
  <!-- Pantalon -->
  <!-- Jambe G -->
  <path d="M${llx},${legTop} L${lavX},${ankleY} L${lavXi},${ankleY} L${llix},${legTop}Z" fill="${pc}"/>
  <!-- Jambe D -->
  <path d="M${rlx},${legTop} L${ravX},${ankleY} L${ravXo},${ankleY} L${rrx},${legTop}Z" fill="${pc}"/>
  <!-- Entre-jambes -->
  <path d="M${llix},${legTop} Q${cx},${legTop+10} ${rlx},${legTop}L${llix},${legTop}Z" fill="${shade(pc,-10)}"/>
  <!-- Pli central -->
  <line x1="${cx-2}" y1="${legTop+6}" x2="${cx-4}" y2="${ankleY-2}" stroke="${ps}" stroke-width=".7" opacity=".5"/>
  <line x1="${cx+2}" y1="${legTop+6}" x2="${cx+4}" y2="${ankleY-2}" stroke="${ps}" stroke-width=".7" opacity=".5"/>
  <!-- Ceinture -->
  <rect x="${cx-hw+3}" y="${legTop-4}" width="${(hw-3)*2}" height="6" rx="2" fill="${shade(pc,-30)}"/>`;
}

function buildArms(skin, sk, o, cx, sw, tw, shoulderY, torsoB, type) {
  // Bras en couche arrière — simplifiés
  const armC = type==='casual' ? o.shirt : (o.jacket || o.shirt);
  const armSk= shade(armC,-18);

  // Point épaule G/D
  const lgSx = cx-sw+2, lgSy = shoulderY+4;
  const rgSx = cx+sw-2, rgSy = shoulderY+4;

  // Coude
  const lgEx = cx-sw-7, lgEy = shoulderY+30;
  const rgEx = cx+sw+7, rgEy = shoulderY+30;

  // Main
  const lgMx = cx-sw-5, lgMy = torsoB-6;
  const rgMx = cx+sw+5, rgMy = torsoB-6;

  const sleeveType = type==='casual'?'short':'long';

  if (sleeveType==='short') {
    // Manche courte : juste jusqu'au coude milieu
    const lgEsX=cx-sw-4, lgEsY=shoulderY+22;
    const rgEsX=cx+sw+4, rgEsY=shoulderY+22;
    const skinC=skin, skinSk=sk;
    return `
    <!-- Bras (manches courtes) -->
    <path d="M${lgSx},${lgSy} L${lgEsX},${lgEsY} L${lgEsX+4},${lgEsY} L${lgSx+6},${lgSy}Z" fill="${armC}" stroke="${armSk}" stroke-width=".6"/>
    <path d="M${rgSx},${rgSy} L${rgEsX},${rgEsY} L${rgEsX-4},${rgEsY} L${rgSx-6},${rgSy}Z" fill="${armC}" stroke="${armSk}" stroke-width=".6"/>
    <!-- Avant-bras skin -->
    <path d="M${lgEsX-1},${lgEsY} L${lgMx-2},${lgMy} L${lgMx+3},${lgMy} L${lgEsX+5},${lgEsY}Z" fill="${skinC}" stroke="${skinSk}" stroke-width=".5"/>
    <path d="M${rgEsX-5},${rgEsY} L${rgMx-3},${rgMy} L${rgMx+2},${rgMy} L${rgEsX+1},${rgEsY}Z" fill="${skinC}" stroke="${skinSk}" stroke-width=".5"/>
    <!-- Mains -->
    <ellipse cx="${lgMx}" cy="${lgMy+4}" rx="5" ry="5.5" fill="${skinC}" stroke="${skinSk}" stroke-width=".5"/>
    <ellipse cx="${rgMx}" cy="${rgMy+4}" rx="5" ry="5.5" fill="${skinC}" stroke="${skinSk}" stroke-width=".5"/>`;
  } else {
    // Manche longue
    const puC = type==='costume' ? o.shirt : o.shirt; // poignet chemise visible
    return `
    <!-- Bras (manches longues) -->
    <path d="M${lgSx},${lgSy} L${lgMx-4},${lgMy} L${lgMx+2},${lgMy} L${lgSx+6},${lgSy}Z" fill="${armC}" stroke="${armSk}" stroke-width=".7"/>
    <path d="M${rgSx},${rgSy} L${rgMx-2},${rgMy} L${rgMx+4},${rgMy} L${rgSx-6},${rgSy}Z" fill="${armC}" stroke="${armSk}" stroke-width=".7"/>
    <!-- Poignets -->
    <rect x="${lgMx-5}" y="${lgMy-1}" width="9" height="6" rx="2" fill="${puC}" stroke="${shade(puC,-15)}" stroke-width=".5"/>
    <rect x="${rgMx-4}" y="${rgMy-1}" width="9" height="6" rx="2" fill="${puC}" stroke="${shade(puC,-15)}" stroke-width=".5"/>
    <!-- Mains skin -->
    <ellipse cx="${lgMx}" cy="${lgMy+8}" rx="4.5" ry="5" fill="${skin}" stroke="${sk}" stroke-width=".5"/>
    <ellipse cx="${rgMx}" cy="${rgMy+8}" rx="4.5" ry="5" fill="${skin}" stroke="${sk}" stroke-width=".5"/>`;
  }
}

function buildTorso(o, cx, sw, tw, hw, shoulderY, torsoB, neckW, skin) {
  const hasJacket = !!o.jacket;
  const nW = neckW, nY = shoulderY-8, nH=10;
  const layers=[];

  // COL / COU
  layers.push(`<rect x="${cx-nW/2}" y="${nY}" width="${nW}" height="${nH+2}" rx="2" fill="${skin}"/>`);

  if (hasJacket) {
    // ─ COSTUME ─
    const jC = o.jacket, jS=shade(jC,-22);
    const shC= o.shirt,  shS=shade(shC,-15);
    const tC = o.tie;

    // Corps veste — forme trapèze
    layers.push(`
    <!-- CHEMISE visible (centre) -->
    <path d="M${cx-nW/2-2},${shoulderY+2} L${cx-tw+2},${torsoB+2} L${cx+tw-2},${torsoB+2} L${cx+nW/2+2},${shoulderY+2}Z" fill="${shC}"/>
    <!-- VESTE corps G -->
    <path d="M${cx-sw+2},${shoulderY} L${cx-tw},${torsoB+3} L${cx-6},${torsoB+3} L${cx-8},${shoulderY+18} L${cx-4},${shoulderY+14}Z" fill="${jC}" stroke="${jS}" stroke-width=".5"/>
    <!-- VESTE corps D -->
    <path d="M${cx+sw-2},${shoulderY} L${cx+tw},${torsoB+3} L${cx+6},${torsoB+3} L${cx+8},${shoulderY+18} L${cx+4},${shoulderY+14}Z" fill="${jC}" stroke="${jS}" stroke-width=".5"/>
    <!-- REVERS G -->
    <path d="M${cx-4},${shoulderY+14} L${cx},${shoulderY+18} L${cx-10},${shoulderY+30} L${cx-12},${shoulderY+28}Z" fill="${shade(jC,-12)}"/>
    <!-- REVERS D -->
    <path d="M${cx+4},${shoulderY+14} L${cx},${shoulderY+18} L${cx+10},${shoulderY+30} L${cx+12},${shoulderY+28}Z" fill="${shade(jC,-12)}"/>
    <!-- CRAVATE -->
    ${tC?`<path d="M${cx-2},${shoulderY+17} L${cx-3.5},${torsoB-8} L${cx},${torsoB-4} L${cx+3.5},${torsoB-8} L${cx+2},${shoulderY+17}Z" fill="${tC}"/>
    <polygon points="${cx},${shoulderY+15} ${cx-3},${shoulderY+19} ${cx},${shoulderY+17} ${cx+3},${shoulderY+19}" fill="${shade(tC,-15)}"/>`:''}
    <!-- Boutton veste -->
    <circle cx="${cx}" cy="${torsoB-14}" r="1.5" fill="${shade(jC,-28)}"/>
    <!-- Col chemise visible -->
    <path d="M${cx-nW/2},${shoulderY+2} L${cx-8},${shoulderY+11} L${cx},${shoulderY+16} L${cx+8},${shoulderY+11} L${cx+nW/2},${shoulderY+2}Z" fill="${shC}" stroke="${shS}" stroke-width=".4"/>
    <!-- Épaules bombées -->
    <ellipse cx="${cx-sw+4}" cy="${shoulderY+4}" rx="6" ry="3.5" fill="${shade(jC,-8)}"/>
    <ellipse cx="${cx+sw-4}" cy="${shoulderY+4}" rx="6" ry="3.5" fill="${shade(jC,-8)}"/>`);

  } else if (o.type==='smart') {
    // ─ CHEMISE ─
    const shC=o.shirt, shS=shade(shC,-18);
    layers.push(`
    <!-- CHEMISE corps -->
    <path d="M${cx-sw+3},${shoulderY} L${cx-tw+2},${torsoB+2} L${cx+tw-2},${torsoB+2} L${cx+sw-3},${shoulderY}Z" fill="${shC}" stroke="${shS}" stroke-width=".6"/>
    <!-- Col -->
    <path d="M${cx-nW/2},${shoulderY+2} L${cx-9},${shoulderY+11} L${cx},${shoulderY+16} L${cx+9},${shoulderY+11} L${cx+nW/2},${shoulderY+2}Z" fill="${shade(shC,-10)}" stroke="${shS}" stroke-width=".4"/>
    <!-- Boutonnage -->
    <line x1="${cx}" y1="${shoulderY+16}" x2="${cx}" y2="${torsoB}" stroke="${shS}" stroke-width=".6" stroke-dasharray="2,2.5"/>
    ${[shoulderY+20,shoulderY+29,shoulderY+38].map(y=>`<circle cx="${cx}" cy="${y}" r="1.2" fill="${shS}"/>`).join('')}
    <!-- Épaules -->
    <ellipse cx="${cx-sw+4}" cy="${shoulderY+4}" rx="5" ry="3" fill="${shade(shC,-16)}"/>
    <ellipse cx="${cx+sw-4}" cy="${shoulderY+4}" rx="5" ry="3" fill="${shade(shC,-16)}"/>`);

  } else {
    // ─ POLO / T-SHIRT ─
    const shC=o.shirt, shS=shade(shC,-18);
    layers.push(`
    <!-- POLO corps -->
    <path d="M${cx-sw+4},${shoulderY} L${cx-tw+3},${torsoB+2} L${cx+tw-3},${torsoB+2} L${cx+sw-4},${shoulderY}Z" fill="${shC}" stroke="${shS}" stroke-width=".6"/>
    <!-- Col polo rond -->
    <path d="M${cx-nW/2+1},${shoulderY+3} Q${cx},${shoulderY+14} ${cx+nW/2-1},${shoulderY+3}" stroke="${shS}" stroke-width="1.2" fill="none" stroke-linecap="round"/>
    <!-- Épaules -->
    <ellipse cx="${cx-sw+5}" cy="${shoulderY+4}" rx="4.5" ry="2.8" fill="${shade(shC,-20)}"/>
    <ellipse cx="${cx+sw-5}" cy="${shoulderY+4}" rx="4.5" ry="2.8" fill="${shade(shC,-20)}"/>`);
  }

  return layers.join('');
}

function buildHead(skin, sk, hair, cx, headCY, headR, genre) {
  const HW = headR*1.05; // légèrement ovale

  // Forme tête — légèrement arrondie en bas (menton)
  const chinY = headCY + headR*1.15;

  const layers=[];

  // Cheveux arrière
  if (genre==='F') {
    layers.push(`
    <!-- Cheveux arrière F -->
    <path d="M${cx-headR+1},${headCY+2} Q${cx-headR-6},${headCY+20} ${cx-headR-4},${chinY+18}" stroke="${hair}" stroke-width="8" fill="none" stroke-linecap="round" opacity=".9"/>
    <path d="M${cx+headR-1},${headCY+2} Q${cx+headR+6},${headCY+20} ${cx+headR+4},${chinY+18}" stroke="${hair}" stroke-width="8" fill="none" stroke-linecap="round" opacity=".9"/>
    <path d="M${cx-headR+3},${headCY+4} Q${cx-headR-4},${headCY+22} ${cx-headR-2},${chinY+20}" stroke="${shade(hair,8)}" stroke-width="4" fill="none" stroke-linecap="round" opacity=".5"/>`);
  }

  // Tête (forme)
  layers.push(`
  <!-- Tête -->
  <path d="M${cx-HW},${headCY} Q${cx-HW},${headCY+headR} ${cx-headR*0.5},${chinY} Q${cx},${chinY+2} ${cx+headR*0.5},${chinY} Q${cx+HW},${headCY+headR} ${cx+HW},${headCY} Q${cx+HW},${headCY-headR} ${cx},${headCY-headR*1.05} Q${cx-HW},${headCY-headR} ${cx-HW},${headCY}Z" fill="${skin}" stroke="${sk}" stroke-width=".7"/>`);

  // Oreilles
  layers.push(`
  <ellipse cx="${cx-HW+1}" cy="${headCY+2}" rx="3" ry="4" fill="${skin}" stroke="${sk}" stroke-width=".5"/>
  <ellipse cx="${cx+HW-1}" cy="${headCY+2}" rx="3" ry="4" fill="${skin}" stroke="${sk}" stroke-width=".5"/>`);

  // Cheveux dessus
  if (genre==='M') {
    layers.push(`
    <!-- Cheveux M court -->
    <path d="M${cx-HW+1},${headCY-2} Q${cx-HW+2},${headCY-headR*1.1} ${cx},${headCY-headR*1.1} Q${cx+HW-2},${headCY-headR*1.1} ${cx+HW-1},${headCY-2}Z" fill="${hair}"/>
    <ellipse cx="${cx}" cy="${headCY-headR*1.05}" rx="${HW-1}" ry="${headR*0.35}" fill="${hair}"/>`);
  } else {
    layers.push(`
    <!-- Cheveux F haut -->
    <path d="M${cx-HW+1},${headCY-2} Q${cx-HW},${headCY-headR*1.1} ${cx},${headCY-headR*1.12} Q${cx+HW},${headCY-headR*1.1} ${cx+HW-1},${headCY-2}Z" fill="${hair}"/>
    <ellipse cx="${cx}" cy="${headCY-headR*1.05}" rx="${HW}" ry="${headR*0.42}" fill="${hair}"/>`);
  }

  // Sourcils
  layers.push(`
  <path d="M${cx-9},${headCY-5} Q${cx-6},${headCY-7} ${cx-2},${headCY-5.5}" stroke="${hair}" stroke-width="1.4" fill="none" stroke-linecap="round"/>
  <path d="M${cx+2},${headCY-5.5} Q${cx+6},${headCY-7} ${cx+9},${headCY-5}" stroke="${hair}" stroke-width="1.4" fill="none" stroke-linecap="round"/>`);

  // Yeux
  layers.push(`
  <!-- Yeux -->
  <ellipse cx="${cx-5.5}" cy="${headCY-1.5}" rx="3.2" ry="2.5" fill="white"/>
  <ellipse cx="${cx+5.5}" cy="${headCY-1.5}" rx="3.2" ry="2.5" fill="white"/>
  <!-- Iris -->
  <circle cx="${cx-5.5}" cy="${headCY-1.5}" r="1.8" fill="${shade(skin,-60)}"/>
  <circle cx="${cx+5.5}" cy="${headCY-1.5}" r="1.8" fill="${shade(skin,-60)}"/>
  <!-- Pupille -->
  <circle cx="${cx-5.5}" cy="${headCY-1.5}" r=".8" fill="#0a0805"/>
  <circle cx="${cx+5.5}" cy="${headCY-1.5}" r=".8" fill="#0a0805"/>
  <!-- Reflet -->
  <circle cx="${cx-4.8}" cy="${headCY-2.2}" r=".55" fill="rgba(255,255,255,.9)"/>
  <circle cx="${cx+6.2}" cy="${headCY-2.2}" r=".55" fill="rgba(255,255,255,.9)"/>
  <!-- Cils bas -->
  <path d="M${cx-8},${headCY+.5} Q${cx-5.5},${headCY+1.5} ${cx-3},${headCY+.5}" stroke="${hair}" stroke-width=".7" fill="none" opacity=".5"/>
  <path d="M${cx+3},${headCY+.5} Q${cx+5.5},${headCY+1.5} ${cx+8},${headCY+.5}" stroke="${hair}" stroke-width=".7" fill="none" opacity=".5"/>`);

  // Nez
  layers.push(`
  <path d="M${cx},${headCY+3} L${cx-2.5},${headCY+8} Q${cx},${headCY+9.5} ${cx+2.5},${headCY+8}" stroke="${shade(skin,-25)}" stroke-width="1" fill="none" stroke-linecap="round"/>`);

  // Bouche
  layers.push(`
  <path d="M${cx-4},${headCY+12} Q${cx},${headCY+15} ${cx+4},${headCY+12}" stroke="${shade(skin,-40)}" stroke-width="1.2" fill="none" stroke-linecap="round"/>`);

  // Joues légères
  layers.push(`
  <circle cx="${cx-8}" cy="${headCY+8}" r="4" fill="rgba(255,100,80,.08)"/>
  <circle cx="${cx+8}" cy="${headCY+8}" r="4" fill="rgba(255,100,80,.08)"/>`);

  return layers.join('');
}

// ════════════════════════════════════════════════════════
//  OUTFIT DEFINITIONS
// ════════════════════════════════════════════════════════
const OUTFITS = {
  costume_bleu:  {shirt:'#d0d8e8',jacket:'#1e3460',pants:'#1e3460',shoes:'#1a1a18',tie:'#8c1f1f',type:'costume'},
  smart_kaki:    {shirt:'#eae0cc',jacket:null,     pants:'#7a7044',shoes:'#6a4c1e',tie:null,     type:'smart'},
  costume_vert:  {shirt:'#f2ede0',jacket:'#2e4122',pants:'#2e4122',shoes:'#1a1a18',tie:'#c9973e',type:'costume'},
  shirt_bold:    {shirt:'#8e1e26',jacket:null,     pants:'#1e3460',shoes:'#8a6320',tie:null,     type:'smart'},
  casual_friday: {shirt:'#2c4c3e',jacket:null,     pants:'#4c4c40',shoes:'#8a6320',tie:null,     type:'casual'},
  sc_navy:       {shirt:'#e8dec8',jacket:null,     pants:'#1e2d50',shoes:'#f0eeec',tie:null,     type:'casual'},
  sc_gold:       {shirt:'#c9973e',jacket:null,     pants:'#2a2a70',shoes:'#4a4a48',tie:null,     type:'casual'},
  sc_grey:       {shirt:'#e8e4d8',jacket:null,     pants:'#5c5c52',shoes:'#f0eeec',tie:null,     type:'casual'},
  sc_terra:      {shirt:'#e05c2a',jacket:null,     pants:'#2a2a70',shoes:'#7a5a22',tie:null,     type:'casual'},
  sc_sage:       {shirt:'#d8e0c8',jacket:null,     pants:'#4c5222',shoes:'#f0eeec',tie:null,     type:'casual'},
};

// ════════════════════════════════════════════════════════
//  DATA
// ════════════════════════════════════════════════════════
const JOBS=[
  {id:'finance',ico:'🏦',n:'Finance / Banque',   c:'STRICT — costume obligatoire'},
  {id:'tech',   ico:'💻',n:'Tech / Startup',     c:'CASUAL — business casual ok'},
  {id:'conseil',ico:'📊',n:'Consulting',          c:'SMART — smart formal flexible'},
  {id:'sante',  ico:'🏥',n:'Santé',               c:'FONCTIONNEL — propre & mobile'},
  {id:'educ',   ico:'🎓',n:'Enseignement',        c:'RESPECTABLE — accessible'},
  {id:'droit',  ico:'⚖️',n:'Droit / Juridique',  c:'STRICT — formelle uniquement'},
  {id:'comm',   ico:'📢',n:'Communication',       c:'CRÉATIF — expressif accepté'},
  {id:'gouv',   ico:'🏛️',n:'Gouvernement',       c:'FORMEL — sobre & stricte'},
  {id:'commerce',ico:'🛒',n:'Commerce',           c:'MOBILE — présentable'},
];
const HIER=[{i:'🌱',l:'Junior'},{i:'📈',l:'Manager'},{i:'💎',l:'Directeur'},{i:'👑',l:'C-Level'}];
const BUDGETS=[{v:15000,a:'15K',t:'ESSENTIEL',tc:'tg'},{v:35000,a:'35K',t:'SMART',tc:'tg'},{v:75000,a:'75K',t:'PREMIUM',tc:'ta'},{v:150000,a:'150K+',t:'LUXE',tc:'ta'}];
const CLIMATS=[
  {id:'tropical', ico:'☀️',n:'Tropical Chaud',  c:'Abidjan · Dakar · Lomé · Accra'},
  {id:'semiaride',ico:'🌵',n:'Semi-Aride',       c:'Bamako · Niamey · Ouagadougou'},
  {id:'equatorial',ico:'🌧️',n:'Équatorial',     c:'Douala · Kinshasa · Libreville'},
  {id:'altitude', ico:'⛰️',n:'Altitude',         c:'Nairobi · Kigali · Addis-Abeba'},
];

const WEEK_F = [
  {day:'LUN',lbl:'Réunion stratégique',outfit:'costume_bleu',sc:94,cr:94,co:62,cpp:'3 200 FCFA',
   pcs:[{c:'#1e3460',n:'Costume bleu nuit',r:false},{c:'#d0d8e8',n:'Chemise bleue pâle',r:false},{c:'#8c1f1f',n:'Cravate bordeaux',r:false},{c:'#1a1a18',n:'Derby noirs',r:false}],
   tags:['HAUTE CRÉDIBILITÉ','FORMELLE']},
  {day:'MAR',lbl:'Présentation client',outfit:'smart_kaki',sc:88,cr:88,co:72,cpp:'2 100 FCFA',
   pcs:[{c:'#7a7044',n:'Pantalon kaki',r:false},{c:'#eae0cc',n:'Chemise écru',r:false},{c:'#6a4c1e',n:'Oxford camel',r:false}],
   tags:['SMART','VARIATION']},
  {day:'MER',lbl:'Mi-semaine',outfit:'costume_vert',sc:91,cr:91,co:68,cpp:'1 800 FCFA',
   pcs:[{c:'#2e4122',n:'Costume vert kaki',r:false},{c:'#f2ede0',n:'Chemise blanche',r:true},{c:'#c9973e',n:'Cravate dorée',r:false},{c:'#1a1a18',n:'Derby noirs',r:true}],
   tags:['RÉUTILISATION','ÉCONOMIQUE']},
  {day:'JEU',lbl:'Leadership',outfit:'shirt_bold',sc:85,cr:85,co:76,cpp:'2 500 FCFA',
   pcs:[{c:'#1e3460',n:'Pantalon costume',r:true},{c:'#8e1e26',n:'Chemise bordeaux',r:false},{c:'#8a6320',n:'Mocassins camel',r:false}],
   tags:['BOLD','AUTORITÉ']},
  {day:'VEN',lbl:'Casual Friday',outfit:'casual_friday',sc:89,cr:89,co:88,cpp:'1 600 FCFA',
   pcs:[{c:'#4c4c40',n:'Chino gris foncé',r:false},{c:'#2c4c3e',n:'Polo vert forêt',r:false},{c:'#8a6320',n:'Mocassins camel',r:true}],
   tags:['CASUAL SMART','BIEN-ÊTRE']},
];
const WEEK_C = [
  {day:'LUN',lbl:'Launch semaine',outfit:'sc_navy',sc:86,cr:86,co:84,cpp:'1 900 FCFA',
   pcs:[{c:'#1e2d50',n:'Chino marine',r:false},{c:'#e8dec8',n:'Chemise oversize',r:false},{c:'#f0eeec',n:'Sneakers blanches',r:false}],
   tags:['BUSINESS CASUAL','MODERNE']},
  {day:'MAR',lbl:'Focus créatif',outfit:'sc_gold',sc:82,cr:82,co:88,cpp:'1 700 FCFA',
   pcs:[{c:'#2a2a70',n:'Jean indigo',r:false},{c:'#c9973e',n:'Polo oxford doré',r:false},{c:'#4a4a48',n:'Derby brun',r:false}],
   tags:['SMART','DYNAMIQUE']},
  {day:'MER',lbl:'Mi-semaine',outfit:'sc_grey',sc:84,cr:84,co:88,cpp:'1 200 FCFA',
   pcs:[{c:'#5c5c52',n:'Chino gris',r:true},{c:'#e8e4d8',n:'T-shirt premium',r:false},{c:'#f0eeec',n:'Sneakers blanches',r:true}],
   tags:['RÉUTILISATION','MINIMAL']},
  {day:'JEU',lbl:'Confiance',outfit:'sc_terra',sc:80,cr:80,co:90,cpp:'1 500 FCFA',
   pcs:[{c:'#2a2a70',n:'Jean indigo',r:true},{c:'#e05c2a',n:'Shirt terracotta',r:false},{c:'#7a5a22',n:'Loafers camel',r:false}],
   tags:['EXPRESSION','CONFIANCE']},
  {day:'VEN',lbl:'Vendredi libre',outfit:'sc_sage',sc:78,cr:78,co:94,cpp:'900 FCFA',
   pcs:[{c:'#4c5222',n:'Short chino kaki',r:false},{c:'#d8e0c8',n:'Linen shirt sage',r:false},{c:'#f0eeec',n:'Sneakers blanches',r:true}],
   tags:['DÉCONTRACTÉ','CONFORT']},
];
const WARDROBE=[
  {id:1,ico:'👔',n:'Costume Bleu Nuit',cat:'haut',cpp:'3 200',uses:15},
  {id:2,ico:'🥼',n:'Pantalon Kaki',cat:'bas',cpp:'1 800',uses:22},
  {id:3,ico:'👕',n:'Chemise Blanche',cat:'haut',cpp:'900',uses:40},
  {id:4,ico:'👞',n:'Derby Noirs',cat:'chaussures',cpp:'1 100',uses:18},
  {id:5,ico:'🥼',n:'Costume Vert Kaki',cat:'haut',cpp:'2 500',uses:12},
  {id:6,ico:'🩴',n:'Mocassins Camel',cat:'chaussures',cpp:'800',uses:24},
  {id:7,ico:'👕',n:'Chemise Bordeaux',cat:'haut',cpp:'1 200',uses:8},
  {id:8,ico:'👕',n:'Polo Oxford',cat:'haut',cpp:'700',uses:30},
  {id:9,ico:'👖',n:'Chino Gris',cat:'bas',cpp:'1 000',uses:20},
  {id:10,ico:'👟',n:'Sneakers Blanches',cat:'chaussures',cpp:'600',uses:28},
  {id:11,ico:'👖',n:'Jean Indigo',cat:'bas',cpp:'950',uses:25},
  {id:12,ico:'👞',n:'Derby Brun',cat:'chaussures',cpp:'1 400',uses:14},
];
const CAREER=[
  {l:'Stagiaire',ico:'🌱',outfit:'sc_navy', style:'Propre & accessible',  desc:'3 pièces capsule. Chemise simple, chino, chaussures de ville propres. Budget ≤ 15K/mois.'},
  {l:'Junior',   ico:'📈',outfit:'smart_kaki',style:'Smart casual maîtrisé',desc:'Introduction du costume. 1 blazer minimum. Chemises variées. Budget 25–40K/mois.'},
  {l:'Manager',  ico:'⭐',outfit:'costume_bleu',style:'Formelle assumée',   desc:'Costume adapté obligatoire. Accessoires soignés. Signal d\'ascension claire.'},
  {l:'Directeur',ico:'💎',outfit:'costume_vert',style:'Authority dressing', desc:'Costumes premium, matières nobles. Cohérence totale. Signal de pouvoir conscient.'},
  {l:'C-Level',  ico:'👑',outfit:'shirt_bold', style:'Signature personnelle',desc:'Style affirmé et distinctif. Dashiki premium en contexte africain. Au-dessus des codes.'},
];

// ════════════════════════════════════════════════════════
//  SCORING ENGINE
// ════════════════════════════════════════════════════════
function score(){
  const mS=S.morpho?84:50;
  const pS={finance:95,droit:92,gouv:90,conseil:88,sante:82,educ:80,commerce:76,comm:78,tech:72}[S.prof]||70;
  const cS={tropical:76,semiaride:70,equatorial:73,altitude:88}[S.climat]||70;
  const bS=S.budget?Math.min(95,48+S.budget/3200):50;
  const eS=S.teint?84:60;
  const hB=S.hier*3;
  return{total:Math.min(99,Math.round(mS*.3+pS*.25+cS*.2+bS*.15+eS*.1+hB)),m:mS,p:pS,c:cS,b:bS,e:eS};
}

function rules(){
  const r=[];
  if(S.morpho==='V') r.push({i:'⚠️',t:'Morphologie V → Éviter épaules structurées excessives'});
  if(S.morpho==='A') r.push({i:'✓',t:'Morphologie A → Valoriser le haut, pantalons droits conseillés'});
  if(S.morpho==='X') r.push({i:'✓',t:'Morphologie X → Toutes coupes valorisantes, ceinture recommandée'});
  if(S.morpho==='O') r.push({i:'✓',t:'Morphologie O → Coupes droites, longueurs intermédiaires'});
  if(S.climat==='tropical') r.push({i:'🌡️',t:'Climat chaud → Lin et coton exclusivement, coupes aérées'});
  if(S.climat==='equatorial') r.push({i:'🌧️',t:'Équatorial → Prévoir imperméable léger en rotation'});
  if(['finance','droit'].includes(S.prof)) r.push({i:'🏦',t:S.prof==='finance'?'Finance → Sneakers exclues, costume+chemise obligatoire':'Droit → Costume complet, couleurs sobres uniquement'});
  if(S.prof==='tech') r.push({i:'💻',t:'Tech → Business casual autorisé, cravate non imposée'});
  if(S.hier>=3) r.push({i:'👑',t:'C-Level → Style signature, dashiki premium en contexte africain'});
  if(S.budget&&S.budget<=15000) r.push({i:'💡',t:'Budget serré → Capsule 5 pièces, maximiser réutilisation'});
  if(['s5','s6'].includes(S.teint)) r.push({i:'🎨',t:'Teint foncé → Couleurs vives et contrastes nets avantageux'});
  if(['s1','s2'].includes(S.teint)) r.push({i:'🎨',t:'Teint clair → Neutres et pastels clairs valorisants'});
  return r;
}

function getWeek(){
  return(['finance','droit','gouv','conseil'].includes(S.prof)||S.hier>=2)?WEEK_F:WEEK_C;
}

// ════════════════════════════════════════════════════════
//  INIT UI
// ════════════════════════════════════════════════════════
function initUI(){
  // Splash avatars
  const combos=[{m:'V',s:'s5',o:'costume_bleu',g:'M'},{m:'X',s:'s3',o:'smart_kaki',g:'F'},{m:'H',s:'s6',o:'sc_navy',g:'M'}];
  const labels=['Morphologie V · Formel','Morphologie X · Smart','Morphologie H · Casual'];
  document.getElementById('spAv').innerHTML=combos.map((c,i)=>
    `<div class="sp-av-wrap" style="animation:rise .7s ${.7+i*.15}s both">
      ${buildAvatar(c.m,c.s,c.o,c.g,138)}
      <div class="sp-av-lbl">${labels[i]}</div>
    </div>`).join('');

  // Steps
  const stpLbls=['Genre & Morphologie','Teint & Stature','Profession','Budget & Climat','Confirmation'];
  document.getElementById('obStps').innerHTML=stpLbls.map((l,i)=>
    `<div class="ob-stp ${i===0?'cur':''}" id="os${i+1}" onclick="jumpStep(${i+1})" title="${i===0?'':i+1+'ère étape — cliquer pour y retourner'}">
      <div class="ob-stp-n">${i+1}</div>
      <div class="ob-stp-l">${l}</div>
    </div>`).join('');

  // Morpho grid
  buildMGrid();

  // Skin
  document.getElementById('skRow').innerHTML=SKINS.map(sk=>
    `<div style="display:flex;flex-direction:column;align-items:center;gap:4px">
      <div class="sk-sw${sk.id==='s5'?' sel':''}" style="background:${sk.hex}"
           onclick="setSkin('${sk.id}',this)" title="${sk.label}"></div>
      <div class="sk-lbl">${sk.label}</div>
    </div>`).join('');

  // Hier
  document.getElementById('hiGrid').innerHTML=HIER.map((h,i)=>
    `<div class="hi-item${i===1?' sel':''}" onclick="setHier(${i},this)">
      <div class="hi-ico">${h.i}</div>
      <div class="hi-lbl">${h.l}</div>
    </div>`).join('');

  // Jobs
  document.getElementById('jGrid').innerHTML=JOBS.map(j=>
    `<div class="job-card" onclick="setJob('${j.id}',this)">
      <div class="job-ico">${j.ico}</div>
      <div><div class="job-n">${j.n}</div><div class="job-c">${j.c}</div></div>
    </div>`).join('');

  // Budget
  document.getElementById('bGrid').innerHTML=BUDGETS.map(b=>
    `<div class="bud-card" onclick="setBud(${b.v},this)">
      <div class="bud-amt">${b.a}</div>
      <div class="bud-unit">FCFA / mois</div>
      <div class="bud-tag ${b.tc}">${b.t}</div>
    </div>`).join('');

  // Climat
  document.getElementById('cGrid').innerHTML=CLIMATS.map(c=>
    `<div class="cl-card" onclick="setCl('${c.id}',this)">
      <div class="cl-ico">${c.ico}</div>
      <div><div class="cl-n">${c.n}</div><div class="cl-c">${c.c}</div></div>
    </div>`).join('');
}

function buildMGrid(){
  const descs={V:'Épaules larges\nHanches étroites',A:'Hanches larges\nÉpaules étroites',H:'Épaules & hanches\nSimilaires',X:'Sablier\nTaille marquée',O:'Silhouette ronde\nBien répartie'};
  document.getElementById('mGrid').innerHTML=Object.keys(MORPH).map(k=>
    `<div class="m-card${S.morpho===k?' sel':''}" onclick="setMorpho('${k}',this)">
      <div class="m-av">${buildAvatar(k,'s4','smart_kaki',S.genre,138)}</div>
      <div class="m-letter">${k}</div>
      <div class="m-desc">${descs[k].replace('\n','<br>')}</div>
    </div>`).join('');
}

// ════════════════════════════════════════════════════════
//  SELECTORS
// ════════════════════════════════════════════════════════
function setG(g,btn){
  S.genre=g;
  document.querySelectorAll('.g-btn').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  buildMGrid();
}
function setMorpho(k,el){
  document.querySelectorAll('.m-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel'); S.morpho=k;
}
function setSkin(id,el){
  document.querySelectorAll('.sk-sw').forEach(s=>s.classList.remove('sel'));
  el.classList.add('sel'); S.teint=id;
}
function setHier(i,el){
  document.querySelectorAll('.hi-item').forEach(h=>h.classList.remove('sel'));
  el.classList.add('sel'); S.hier=i;
}
function setJob(id,el){
  document.querySelectorAll('.job-card').forEach(j=>j.classList.remove('sel'));
  el.classList.add('sel'); S.prof=id;
}
function setBud(v,el){
  document.querySelectorAll('.bud-card').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel'); S.budget=v;
}
function setCl(id,el){
  document.querySelectorAll('.cl-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel'); S.climat=id;
}

// ════════════════════════════════════════════════════════
//  NAVIGATION
// ════════════════════════════════════════════════════════
function go(id){
  document.querySelectorAll('.scr').forEach(s=>{s.classList.remove('on');s.style.display='';});
  const el=document.getElementById(id);
  if(id==='ob'){el.classList.add('on');}
  else if(id==='db'){el.classList.add('on');}
  else el.classList.add('on');
  updProgress();
}

function nxt(){if(curStep<STEPS){if(curStep===STEPS-1)buildRecap();showStep(curStep+1);}}
function prv(){if(curStep>1)showStep(curStep-1);}

// Clic sur un step de la sidebar — retour arrière seulement
function jumpStep(n){
  if(n < curStep) showStep(n);
}

// Retour splash depuis onboarding
function backToSplash(){
  go('splash');
  curStep=1;
  showStep(1);
}

// Retour onboarding depuis dashboard (modifier profil)
function backToOnboarding(){
  go('ob');
  buildRecap(); // rafraîchit le récap avec l'état actuel
  showStep(curStep); // revient à la dernière étape (5 = recap par défaut)
}

function showStep(n){
  document.querySelectorAll('.ob-panel').forEach(p=>p.classList.remove('on'));
  document.getElementById(`p${n}`).classList.add('on');
  document.querySelectorAll('.ob-stp').forEach((s,i)=>{
    s.classList.remove('cur','done');
    const num=s.querySelector('.ob-stp-n');
    if(i+1===n){s.classList.add('cur');num.textContent=i+1;}
    else if(i+1<n){s.classList.add('done');num.textContent='✓';}
    else num.textContent=i+1;
  });
  curStep=n; updProgress();
}

function updProgress(){
  const pct=Math.round(((curStep-1)/(STEPS-1))*100);
  const fill=document.getElementById('obFill');
  const pctEl=document.getElementById('obPct');
  if(fill) fill.style.width=pct+'%';
  if(pctEl) pctEl.textContent=pct+'%';
}

function buildRecap(){
  const rls=rules();
  const pL=JOBS.find(j=>j.id===S.prof)?.n||'—';
  const cL=CLIMATS.find(c=>c.id===S.climat)?.n||'—';
  document.getElementById('rcGrid').innerHTML=[
    {l:'Morphologie',v:S.morpho||'—'},{l:'Genre',v:S.genre==='M'?'Masculin':'Féminin'},
    {l:'Profession',v:pL},{l:'Budget/mois',v:S.budget?S.budget.toLocaleString('fr')+' FCFA':'—'},
    {l:'Climat',v:cL},{l:'Niveau',v:HIER[S.hier]?.l||'—'},
  ].map(r=>`<div class="rc-item"><div class="rc-lbl">${r.l}</div><div class="rc-val">${r.v}</div></div>`).join('');
  document.getElementById('rlList').innerHTML=rls.length
    ?rls.map(r=>`<div class="rl-row"><span class="rl-i">${r.i}</span>${r.t}</div>`).join('')
    :'<div class="rl-row"><span class="rl-i">ℹ️</span>Complète ton profil pour activer les règles</div>';
}

function launch(){
  document.getElementById('ob').classList.remove('on');
  document.getElementById('db').classList.add('on');
  renderDB(); toast('⚡ Système initialisé — Semaine générée');
}

// ════════════════════════════════════════════════════════
//  DASHBOARD RENDER
// ════════════════════════════════════════════════════════
function renderDB(){
  const sc=score();
  const pL=JOBS.find(j=>j.id===S.prof)?.n?.split('/')[0]?.trim()||'Pro';
  document.getElementById('dbUL').textContent=pL;
  document.getElementById('dbAv').textContent=pL[0];
  
  // Score
  animN('scN',sc.total);
  const gr=sc.total>=88?'A+':sc.total>=80?'A':sc.total>=72?'B+':'B';
  const gc=sc.total>=88?'sga':sc.total>=75?'sgb':'sgc';
  document.getElementById('scG').textContent=`GRADE ${gr}`;
  document.getElementById('scG').className=`sc-grade ${gc}`;
  document.getElementById('scAx').innerHTML=[
    {n:'Morphologie',v:sc.m,c:'#d4a843'},{n:'Profession',v:sc.p,c:'#79b554'},
    {n:'Climat',v:sc.c,c:'#5191c9'},{n:'Budget',v:sc.b,c:'#c95a4a'},{n:'Esthétique',v:sc.e,c:'#b08830'},
  ].map(a=>`<div class="ax"><div class="ax-top"><span class="ax-n">${a.n}</span><span class="ax-v">${Math.round(a.v)}</span></div>
    <div class="ax-track"><div class="ax-fill" style="width:${a.v}%;background:${a.c}"></div></div></div>`).join('');

  // Week
  const week=getWeek();
  const rc=week.flatMap(d=>d.pcs).filter(p=>p.r).length;
  document.getElementById('rChip').textContent=`${rc} pièces réutilisées`;
  document.getElementById('wGrid').innerHTML=week.map((d,i)=>
    `<div class="day-card" onclick="openD(${i})">
      <div class="dc-head">
        <div class="dc-day">${d.day}</div>
        <div class="dc-score ${d.sc>=88?'dca':'dcg'}">${d.sc}</div>
      </div>
      <div class="av-stage">${buildAvatar(S.morpho||'H',S.teint,d.outfit,S.genre,193)}</div>
      <div class="dc-body">
        <div class="dc-outfit-name">${d.lbl}</div>
        <div class="dc-pieces">
          ${d.pcs.map(p=>`<div class="dc-piece">
            <div class="dc-dot" style="background:${p.c}"></div>
            <div class="dc-txt">${p.n}</div>
            ${p.r?'<span class="dc-r">↩ RÉUTIL.</span>':''}
          </div>`).join('')}
        </div>
        <div class="dc-tags">${d.tags.map(t=>`<div class="dc-tag">${t}</div>`).join('')}</div>
      </div>
    </div>`).join('');

  // Wardrobe
  document.getElementById('wrdGrid').innerHTML=WARDROBE.map(w=>
    `<div class="wrd-card" data-cat="${w.cat}">
      <div class="wrd-img">${w.ico}</div>
      <div class="wrd-info">
        <div class="wrd-n">${w.n}</div>
        <div class="wrd-t">${w.cat}</div>
        <div class="wrd-st"><div class="wrd-cpp">${w.cpp} FCFA/port</div><div class="wrd-uses">×${w.uses}</div></div>
      </div>
    </div>`).join('');

  // Career
  document.getElementById('careerCont').innerHTML=CAREER.map((c,i)=>
    `<div style="display:grid;grid-template-columns:88px 1fr;gap:18px;align-items:start;
          padding:18px;background:var(--s1);border:1.5px solid ${S.hier===i?'var(--gold)':'var(--b1)'};
          border-radius:var(--r2);margin-bottom:10px;cursor:pointer;
          background:${S.hier===i?'rgba(212,168,67,.07)':'var(--s1)'};"
          onclick="highlightCareer(this)">
      <div style="background:var(--s2);border-radius:var(--r2);padding:8px 4px;
                  border:1px solid var(--b1);text-align:center">
        ${buildAvatar(S.morpho||'H',S.teint,c.outfit,S.genre,96)}
      </div>
      <div>
        <div style="display:flex;align-items:center;gap:9px;margin-bottom:5px">
          <span style="font-size:16px">${c.ico}</span>
          <span style="font-family:var(--ftitle);font-size:21px;letter-spacing:.05em">${c.l}</span>
          ${S.hier===i?'<span style="font-size:8px;font-family:var(--fmono);padding:2px 8px;background:var(--golddim);color:var(--gold);border-radius:99px">ACTUEL</span>':''}
        </div>
        <div style="color:var(--gold);font-family:var(--fmono);font-size:9px;letter-spacing:.1em;margin-bottom:7px">${c.style}</div>
        <div style="font-size:12px;color:var(--t2);font-weight:300;line-height:1.65">${c.desc}</div>
      </div>
    </div>`).join('');

  // Side
  const pL2=JOBS.find(j=>j.id===S.prof)?.n||'—';
  const cL=CLIMATS.find(c=>c.id===S.climat)?.n||'—';
  document.getElementById('ssProf').innerHTML=[
    {k:'Morphologie',v:S.morpho||'—'},{k:'Profession',v:pL2},
    {k:'Niveau',v:HIER[S.hier]?.l||'—'},{k:'Budget/mois',v:S.budget?S.budget.toLocaleString('fr')+' FCFA':'—'},
    {k:'Climat',v:cL},{k:'Genre',v:S.genre==='M'?'Masculin':'Féminin'},
  ].map(s=>`<div class="ss-row"><div class="ss-k">${s.k}</div><div class="ss-v">${s.v}</div></div>`).join('');

  const rls=rules();
  document.getElementById('ssIns').innerHTML=rls.slice(0,4).map(r=>
    `<div class="insight"><div class="in-i">${r.i}</div>${r.t}</div>`).join('')
    ||'<div class="insight"><div class="in-i">📌</div>Complète ton profil</div>';

  document.getElementById('ssSt').innerHTML=[
    {k:'Pièces réutilisées',v:`${rc}/semaine`},{k:'Coût moyen/jour',v:'2 100 FCFA'},
    {k:'Total garde-robe',v:`${WARDROBE.length} pièces`},{k:'Score global',v:`${sc.total}/100`},
  ].map(s=>`<div class="ss-row"><div class="ss-k">${s.k}</div><div class="ss-v">${s.v}</div></div>`).join('');
}

function highlightCareer(el){
  document.querySelectorAll('#careerCont>div').forEach(d=>{d.style.border='1.5px solid var(--b1)';d.style.background='var(--s1)'});
  el.style.border='1.5px solid var(--gold)'; el.style.background='rgba(212,168,67,.07)';
}

// ════════════════════════════════════════════════════════
//  DRAWER
// ════════════════════════════════════════════════════════
function openD(idx){
  const week=getWeek(); const d=week[idx];
  document.getElementById('drDay').textContent=`${d.day}NDAY`;
  document.getElementById('drTitle').textContent=d.lbl;
  document.getElementById('drBody').innerHTML=`
    <div class="dr-av-stage">${buildAvatar(S.morpho||'H',S.teint,d.outfit,S.genre,272)}</div>
    <div class="dr-metrics">
      <div class="dr-metric"><div class="dr-mv" style="color:var(--gold)">${d.cr}</div><div class="dr-ml">CRÉDIBILITÉ</div></div>
      <div class="dr-metric"><div class="dr-mv" style="color:var(--green)">${d.co}</div><div class="dr-ml">CONFORT CLIM.</div></div>
      <div class="dr-metric" style="grid-column:span 2"><div class="dr-mv" style="color:var(--blue);font-size:24px">${d.cpp}</div><div class="dr-ml">COÛT PAR PORT</div></div>
    </div>
    <div>
      <div style="font-family:var(--fmono);font-size:8px;letter-spacing:.3em;color:var(--t3);text-transform:uppercase;padding-bottom:8px;border-bottom:1px solid var(--b1);margin-bottom:12px">Composition</div>
      ${d.pcs.map(p=>`<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--s2);border-radius:var(--r);border:1px solid var(--b1);margin-bottom:6px">
        <div style="width:11px;height:11px;border-radius:3px;background:${p.c};flex-shrink:0"></div>
        <div style="flex:1;font-size:12px">${p.n}</div>
        ${p.r?'<span style="font-size:8px;font-family:var(--fmono);padding:2px 7px;background:var(--golddim);color:var(--gold);border-radius:4px">↩ RÉUTIL.</span>':'<span style="font-size:8px;color:var(--t3);font-family:var(--fmono)">NEUF</span>'}
      </div>`).join('')}
    </div>
    <div>
      <div style="font-family:var(--fmono);font-size:8px;letter-spacing:.3em;color:var(--t3);text-transform:uppercase;padding-bottom:8px;border-bottom:1px solid var(--b1);margin-bottom:12px">Règles moteur</div>
      ${rules().slice(0,3).map(r=>`<div class="insight"><div class="in-i">${r.i}</div>${r.t}</div>`).join('')}
    </div>
    <div class="chips">${d.tags.map(t=>`<div class="chip on">${t}</div>`).join('')}</div>`;
  document.getElementById('ov').classList.add('on');
  document.getElementById('drw').classList.add('on');
}

function closeD(){
  document.getElementById('ov').classList.remove('on');
  document.getElementById('drw').classList.remove('on');
}

// ════════════════════════════════════════════════════════
//  TABS & FILTERS
// ════════════════════════════════════════════════════════
function dTab(t,el){
  document.querySelectorAll('.db-tab').forEach(b=>b.classList.remove('on')); el.classList.add('on');
  ['week','wardrobe','career'].forEach(n=>document.getElementById(`t-${n}`).style.display=n===t?'block':'none');
}
function wrdF(cat,el){
  document.querySelectorAll('#wrdChips .chip').forEach(c=>c.classList.remove('on')); el.classList.add('on');
  document.querySelectorAll('.wrd-card').forEach(c=>c.style.display=cat==='all'||c.dataset.cat===cat?'':'none');
}

// ════════════════════════════════════════════════════════
//  UTILS
// ════════════════════════════════════════════════════════
function animN(id,target){
  let v=0;const el=document.getElementById(id);const s=target/55;
  const t=setInterval(()=>{v=Math.min(v+s,target);el.textContent=Math.round(v);if(v>=target)clearInterval(t)},16);
}
function toast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('on');
  setTimeout(()=>t.classList.remove('on'),3000);
}

// Boot
initUI();
</script>
</body>
</html>
